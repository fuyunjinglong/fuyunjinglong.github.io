

## watchã€watchEffectåŒºåˆ«

- 1ã€watchæ˜¯æƒ°æ€§æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åªæœ‰ç›‘å¬çš„å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œï¼Œä½†æ˜¯watchEffectä¸åŒï¼Œæ¯æ¬¡ä»£ç åŠ è½½watchEffectéƒ½ä¼šæ‰§è¡Œï¼ˆå¿½ç•¥watchç¬¬ä¸‰ä¸ªå‚æ•°çš„é…ç½®ï¼Œå¦‚æœä¿®æ”¹é…ç½®é¡¹ä¹Ÿå¯ä»¥å®ç°ç«‹å³æ‰§è¡Œï¼‰
- 2ã€watchéœ€è¦ä¼ é€’ç›‘å¬çš„å¯¹è±¡ï¼ŒwatchEffectä¸éœ€è¦
- 3ã€watchåªèƒ½ç›‘å¬å“åº”å¼æ•°æ®ï¼šrefå®šä¹‰çš„å±æ€§å’Œreactiveå®šä¹‰çš„å¯¹è±¡ï¼Œå¦‚æœç›´æ¥ç›‘å¬reactiveå®šä¹‰å¯¹è±¡ä¸­çš„å±æ€§æ˜¯ä¸å…è®¸çš„ï¼Œé™¤éä½¿ç”¨å‡½æ•°è½¬æ¢ä¸€ä¸‹
- 4ã€watchEffectå¦‚æœç›‘å¬reactiveå®šä¹‰çš„å¯¹è±¡æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œåªèƒ½ç›‘å¬å¯¹è±¡ä¸­çš„å±æ€§ã€‚

```js
  let count = ref(0)
    let countObj = reactive({count: 0})

    // æƒ°æ€§ï¼Œé¦–æ¬¡åŠ è½½ä¸æ‰§è¡Œ
    watch(count, (newVal, oldVal) =>{console.log(newVal, oldVal)} )
    // watch ä¸èƒ½ç›´æ¥ç›‘å¬reactiveé‡Œé¢çš„å±æ€§ï¼Œåªèƒ½ç›‘å¬refã€reactiveObjectï¼Œ functionï¼Œ array, å¦‚æœæƒ³ç›‘å¬reactiveçš„æŸä¸ªå±æ€§ï¼Œé‚£ä¹ˆéœ€è¦è½¬æ¢æˆå‡½æ•°
    watch(() => countObj.count, (newVal, oldVal) => {console.log(oldVal, newVal)}, {})
    watch (countObj, (newVal, oldVal) => {
      console.log(newVal, oldVal)
    })
    // ç›‘å¬å¤šä¸ªå€¼ï¼Œå‰é¢æ˜¯ç›‘å¬æ•°æ®çš„æ•°ç»„ï¼Œåé¢çš„å‚æ•°æ˜¯ä¸¤ä¸ªæ•°ç»„ï¼Œå‰é¢æ•°ç»„æ˜¯å˜åŒ–åç›‘å¬å¯¹è±¡å€¼çš„æ•°ç»„ï¼Œåé¢æ˜¯å˜åŒ–å‰ç›‘å¬å¯¹è±¡å€¼çš„æ•°ç»„
    watch ([countObj, count], ([oneNewName, twoNewName], [oneOldName, twoOldName]) => {
      console.log(oneNewName, oneOldName, twoNewName, twoOldName)
    })
    // watchEffectï¼Œå’Œwatchä¸ä¸€æ ·ï¼Œ1ã€ä¼šç«‹å³æ‰§è¡Œï¼Œåªè¦å®šä¹‰äº†å°±ä¼šæ‰§è¡Œã€‚2ã€ä»–åªèƒ½ç›‘å¬æŸä¸ªå€¼ï¼Œç›‘å¬å¯¹è±¡ä¸ç®¡ç”¨ã€‚3ã€ä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œä¼šè‡ªåŠ¨ç®¡åˆ¶ä»£ç ä¸­çš„å˜é‡ã€‚4ã€æ²¡æ³•è·å–newValå’ŒoldVal
    const watchEf = watchEffect(() => {
      console.log(countObj.count)
    })
```

**watchEffectå‰¯ä½œç”¨å‡½æ•°**

å®šä¹‰ï¼šwatchEffectçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç”¨äºæ³¨å†Œå‰¯ä½œç”¨æ¸…ç†çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨å‰¯ä½œç”¨å‡½æ•°ä¸‹ä¸€æ¬¡é‡æ–°æ‰§è¡Œå‰è°ƒç”¨ï¼Œå¤šç”¨äºå–æ¶ˆé‡å¤è¯·æ±‚ã€é˜²æŠ–ã€äº‹ä»¶æ³¨å†Œé”€æ¯ç­‰ã€‚

```js
// å–æ¶ˆé‡å¤è¯·æ±‚
watch(source, async (old, new, OnCleanup) => {
  // æ˜¯å¦è¿‡æœŸæ˜¯æ ‡å¿—
  let expired = false
  // æ³¨å†Œè¿‡æœŸå›è°ƒ
  OnCleanup(()=> {
    expired = true
  })
 const res = await fetch('something')
 // å¦‚æœæœªè¿‡æœŸï¼Œé‚£ä¹ˆå¯ä»¥å–resä¸ºfinalData
 if (!expired) {
   finalData = res
 }
})

// é˜²æŠ–
const id = ref(13)
watchEffect(onInvalidate => {
   // å¼‚æ­¥è¯·æ±‚
  const token = performAsyncOperation(id.value)
  // å¦‚æœidé¢‘ç¹æ”¹å˜ï¼Œä¼šè§¦å‘å¤±æ•ˆå‡½æ•°ï¼Œå–æ¶ˆä¹‹å‰çš„æ¥å£è¯·æ±‚
  onInvalidate(() => {
    // id has changed or watcher is stopped.
    // invalidate previously pending async operation
    token.cancel()
  })
})

// domçš„äº‹ä»¶ç›‘å¬å’Œå–æ¶ˆç›‘å¬
onMounted(()=>{
  watchEffect((onInvalidate) => {
    document.querySelector('.btn').addEventListener('click', handleClick, false)
    onInvalidate(() => document.querySelector('.btn').removeEventListener('click', handleClick))
  })
})
```



## ç”Ÿå‘½å‘¨æœŸ

> Vue2--------------vue3
> beforeCreate  -> setup() // å¼€å§‹åˆ›å»ºç»„ä»¶ä¹‹å‰ï¼Œåœ¨`beforeCreate`å’Œ`created`ä¹‹å‰æ‰§è¡Œã€‚åˆ›å»ºçš„æ˜¯`data`å’Œ`method`
> created       -> setup()
> beforeMount   -> onBeforeMount // ç»„ä»¶æŒ‚è½½åˆ°èŠ‚ç‚¹ä¸Šä¹‹å‰æ‰§è¡Œ
> mounted       -> onMounted // ç»„ä»¶æŒ‚è½½å®Œæˆåæ‰§è¡Œ
> beforeUpdate  -> onBeforeUpdate //  ç»„ä»¶æ›´æ–°ä¹‹å‰æ‰§è¡Œ
> updated       -> onUpdated // ç»„ä»¶æ›´æ–°å®Œæˆä¹‹åæ‰§è¡Œ
> beforeDestroy -> onBeforeUnmount // ç»„ä»¶å¸è½½ä¹‹å‰æ‰§è¡Œ
> destroyed     -> onUnmounted // ç»„ä»¶å¸è½½å®Œæˆåæ‰§è¡Œ
> activated     -> onActivated // è¢«åŒ…å«åœ¨`<keep-alive>`ä¸­çš„ç»„ä»¶ï¼Œä¼šå¤šå‡ºä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ã€‚è¢«æ¿€æ´»æ—¶æ‰§è¡Œã€‚
> deactivated   -> onDeactivated // æ¯”å¦‚ä» A ç»„ä»¶ï¼Œåˆ‡æ¢åˆ° B ç»„ä»¶ï¼ŒA ç»„ä»¶æ¶ˆå¤±æ—¶æ‰§è¡Œ
> errorCaptured -> onErrorCaptured // å½“æ•è·ä¸€ä¸ªæ¥è‡ªå­å­™ç»„ä»¶çš„å¼‚å¸¸æ—¶æ¿€æ´»é’©å­å‡½æ•°

**æ–°å¢ onRenderTracked()å’Œ onRenderTriggered()**

onRenderTracked()

> ç›´è¯‘è¿‡æ¥å°±æ˜¯`çŠ¶æ€è·Ÿè¸ª`ï¼Œå®ƒä¼šè·Ÿè¸ªé¡µé¢ä¸Šæ‰€æœ‰å“åº”å¼å˜é‡å’Œæ–¹æ³•çš„çŠ¶æ€ã€‚åªè¦é¡µé¢æœ‰`update`çš„æƒ…å†µï¼Œä»–å°±ä¼šè·Ÿè¸ªï¼Œç„¶åç”Ÿæˆä¸€ä¸ª`event`å¯¹è±¡ã€‚

onRenderTriggered()

> ç›´è¯‘è¿‡æ¥æ˜¯`çŠ¶æ€è§¦å‘`ï¼Œå®ƒä¸ä¼šè·Ÿè¸ªæ¯ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯ç»™ä½ å˜åŒ–å€¼çš„ä¿¡æ¯ï¼Œå¹¶ä¸”æ–°å€¼å’Œæ—§å€¼éƒ½ä¼šç»™ä½ æ˜ç¡®çš„å±•ç¤ºå‡ºæ¥ã€‚ ä¸`watch`ç›¸ä¼¼ã€‚
>
> event å¯¹è±¡å±æ€§çš„è¯¦ç»†ä»‹ç»ï¼š
>
> - key é‚£è¾¹å˜é‡å‘ç”Ÿäº†å˜åŒ–
> - newValue æ›´æ–°åå˜é‡çš„å€¼
> - oldValue æ›´æ–°å‰å˜é‡çš„å€¼
> - target ç›®å‰é¡µé¢ä¸­çš„å“åº”å˜é‡å’Œå‡½æ•°

## setupè¯­æ³•ç³–å°±æ˜¯é¦™

- ç»„ä»¶è‡ªåŠ¨æ³¨å†Œ
- ç»„ä»¶æ ¸å¿ƒ API
- å±æ€§å’Œæ–¹æ³•ç›´æ¥ä½¿ç”¨

**ç»„ä»¶è‡ªåŠ¨æ³¨å†Œ**

å®ƒä¼šè‡ªåŠ¨ä»¥æ–‡ä»¶åä¸ºä¸»ï¼Œä¹Ÿå°±æ˜¯ä¸ç”¨å†å†™`name`å±æ€§äº†

**ç»„ä»¶æ ¸å¿ƒ API**

1.ä½¿ç”¨ props

é€šè¿‡`defineProps`æŒ‡å®šå½“å‰ props ç±»å‹ï¼Œè·å¾—ä¸Šä¸‹æ–‡çš„propså¯¹è±¡ã€‚ç¤ºä¾‹ï¼š

```vue
<script setup>
  import { defineProps } from 'vue'
  const props = defineProps({
    title: String,
  })
</script>
```

2.ä½¿ç”¨ emits

ä½¿ç”¨`defineEmit`å®šä¹‰å½“å‰ç»„ä»¶å«æœ‰çš„äº‹ä»¶ï¼Œå¹¶é€šè¿‡è¿”å›çš„ä¸Šä¸‹æ–‡å»æ‰§è¡Œ emitã€‚ç¤ºä¾‹ï¼š

```vue
<script setup>
  import { defineEmits } from 'vue'
  const emit = defineEmits(['change', 'delete'])
</script>
```

3.è·å– slots å’Œ attrs

å¯ä»¥é€šè¿‡`useContext`ä»ä¸Šä¸‹æ–‡ä¸­è·å– slots å’Œ attrsã€‚ä¸è¿‡ææ¡ˆåœ¨æ­£å¼é€šè¿‡åï¼ŒåºŸé™¤äº†è¿™ä¸ªè¯­æ³•ï¼Œè¢«æ‹†åˆ†æˆäº†`useAttrs`å’Œ`useSlots`ã€‚ç¤ºä¾‹ï¼š

```vue
// æ—§
<script setup>
  import { useContext } from 'vue'
  const { slots, attrs } = useContext()
</script>

// æ–°
<script setup>
  import { useAttrs, useSlots } from 'vue'
  const attrs = useAttrs()
  const slots = useSlots()
</script>
```

4.defineExpose API

ä¼ ç»Ÿçš„å†™æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­ï¼Œé€šè¿‡ ref å®ä¾‹çš„æ–¹å¼å»è®¿é—®å­ç»„ä»¶çš„å†…å®¹ï¼Œä½†åœ¨ script setup ä¸­ï¼Œè¯¥æ–¹æ³•å°±ä¸èƒ½ç”¨äº†ï¼Œsetup ç›¸å½“äºæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œé™¤äº†å†…éƒ¨çš„ `template`æ¨¡æ¿ï¼Œè°éƒ½ä¸èƒ½è®¿é—®å†…éƒ¨çš„æ•°æ®å’Œæ–¹æ³•ã€‚

å¦‚æœéœ€è¦å¯¹å¤–æš´éœ² setup ä¸­çš„æ•°æ®å’Œæ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨ defineExpose APIã€‚ç¤ºä¾‹ï¼š

```vue
<script setup>
 import { defineExpose } from 'vue'
 const a = 1
 const b = 2
 defineExpose({
     a
 })
</script>
```

**å±æ€§å’Œæ–¹æ³•ç›´æ¥ä½¿ç”¨**

å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•æ— éœ€è¿”å›ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨

## Vue3æ ‡å‡†æ¨¡æ¿

**æ¨¡æ¿å·¥å…·ï¼š**

- `ç¼–ç¨‹è¯­è¨€`ï¼š**TypeScript 4.x ã€JavaScript**
- `å‰ç«¯æ¡†æ¶`ï¼š**Vue 3.x**
- `æ„å»ºå·¥å…·`ï¼š**Vite 2.x**
- `UI æ¡†æ¶`ï¼š**Element Plus**
- `å›¾æ ‡å·¥å…·`ï¼š**icones**
- `CSSé¢„ç¼–è¯‘`ï¼š**Sass**
- `CSSæ¡†æ¶`ï¼š**Windi CSS**
- `HTTPå·¥å…·`ï¼š**Axios**
- `è·¯ç”±ç®¡ç†`ï¼š**Vue Router 4.x**
- `çŠ¶æ€ç®¡ç†`ï¼š**Pinia**
- `ä»£ç è§„èŒƒ`ï¼š**EditorConifgã€Prettierã€ESLintã€Airbnb JavaScript Style Guide**
- `æäº¤è§„èŒƒ`ï¼š**huskyã€Commitlint ã€lint-staged**

- `å®ç°è‡ªåŠ¨æŒ‰éœ€åŠ è½½`ï¼ˆ**`å¢™è£‚æ¨è`**ï¼‰ï¼š**unplugin-auto-importã€unplugin-vue-componentsã€unplugin-icons**
- `å®ç° SVGå›¾æ ‡ çš„ç»„ä»¶åŒ–`ï¼š**vite-svg-loader**
- `è®©å„ç§ API æ”¯æŒå“åº”å¼`ï¼š**VueUse**
- `è®©åŠ è½½é¡µé¢æ—¶æœ‰æ‰€åé¦ˆ`ï¼š**NProgress**
- `æ”¯æŒ markdown`ï¼š**vite-plugin-md**
- vetur -> volar:å¯¹äº vue3 çš„æ”¯æŒï¼Œ`vetur` å¾ˆæ˜æ˜¾çš„ä¸å¦‚ `volar`ï¼Œè¿™è¾¹å»ºè®®å°ä¼™ä¼´ä»¬ç¦ç”¨vueturè€Œä½¿ç”¨volor

**æ¨¡æ¿ä»£ç ç›®å½•ç»“æ„ï¼š**

- `.husky`ï¼šç”¨æ¥æ”¾husky é’©å­çš„é…ç½®æ–‡ä»¶å¤¹
- `.vscode`ï¼šç”¨æ¥æ”¾é¡¹ç›®ä¸­çš„ vscode é…ç½®
- `presets`ï¼šç”¨æ¥æ”¾ vite æ’ä»¶çš„ plugin é…ç½®
- `public`ï¼šç”¨æ¥æ”¾ä¸€äº›è¯¸å¦‚ é¡µå¤´icon ä¹‹ç±»çš„å…¬å…±æ–‡ä»¶ï¼Œä¼šè¢«æ‰“åŒ…åˆ°distæ ¹ç›®å½•ä¸‹
- `src`ï¼šç”¨æ¥æ”¾é¡¹ç›®ä»£ç æ–‡ä»¶
- `api`ï¼šç”¨æ¥æ”¾httpçš„ä¸€äº›æ¥å£é…ç½®
- `assets`ï¼šç”¨æ¥æ”¾ä¸€äº› CSS ä¹‹ç±»çš„é™æ€èµ„æº
- `components`ï¼šç”¨æ¥æ”¾ Vue ç»„ä»¶
- `layout`ï¼šç”¨æ¥æ”¾é¡¹ç›®çš„å¸ƒå±€
- `router`ï¼šç”¨æ¥æ”¾é¡¹ç›®çš„è·¯ç”±é…ç½®
- `store`ï¼šç”¨æ¥æ”¾çŠ¶æ€ç®¡ç†Piniaçš„é…ç½®
- `utils`ï¼šç”¨æ¥æ”¾é¡¹ç›®ä¸­çš„å·¥å…·æ–¹æ³•ç±»
- `views`ï¼šç”¨æ¥æ”¾é¡¹ç›®çš„.vueè§†å›¾

#

# è°ƒç”¨å †æ ˆ

## æ‰§è¡Œæ ˆ

æ‰§è¡Œæ ˆï¼Œä¹Ÿå«è°ƒç”¨æ ˆï¼Œå…·æœ‰ LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰ç»“æ„ï¼Œç”¨äºå­˜å‚¨åœ¨ä»£ç æ‰§è¡ŒæœŸé—´åˆ›å»ºçš„**æ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡**ã€‚

å› ä¸ºJSå¼•æ“åˆ›å»ºäº†å¾ˆå¤šçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥JSå¼•æ“åˆ›å»ºäº†æ‰§è¡Œä¸Šä¸‹æ–‡**æ ˆ**ï¼ˆExecution context stackï¼ŒECSï¼‰æ¥**ç®¡ç†**æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

å½“ JavaScript åˆå§‹åŒ–çš„æ—¶å€™ä¼šå‘æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆå‹å…¥ä¸€ä¸ª**å…¨å±€**æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬ç”¨ globalContext è¡¨ç¤ºå®ƒï¼Œå¹¶ä¸”åªæœ‰å½“æ•´ä¸ªåº”ç”¨ç¨‹åºç»“æŸçš„æ—¶å€™ï¼Œæ‰§è¡Œæ ˆæ‰ä¼šè¢«æ¸…ç©ºï¼Œæ‰€ä»¥ç¨‹åºç»“æŸä¹‹å‰ï¼Œ æ‰§è¡Œæ ˆæœ€åº•éƒ¨æ°¸è¿œæœ‰ä¸ª globalContextã€‚

**ä¸€ã€æ‰§è¡Œä¸Šä¸‹æ–‡**

æ‰§è¡Œä¸Šä¸‹æ–‡æ€»å…±æœ‰ä¸‰ç§ç±»å‹

- **å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼šåªæœ‰ä¸€ä¸ªï¼Œæµè§ˆå™¨ä¸­çš„å…¨å±€å¯¹è±¡å°±æ˜¯ window å¯¹è±¡ï¼Œ`this` æŒ‡å‘è¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚
- **å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼šå­˜åœ¨æ— æ•°ä¸ªï¼Œåªæœ‰åœ¨å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™æ‰ä¼šè¢«åˆ›å»ºï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚
- **Eval å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼š æŒ‡çš„æ˜¯è¿è¡Œåœ¨ `eval` å‡½æ•°ä¸­çš„ä»£ç ï¼Œå¾ˆå°‘ç”¨è€Œä¸”ä¸å»ºè®®ä½¿ç”¨ã€‚

**äºŒã€æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»º**

åˆ†ä¸º2ä¸ªé˜¶æ®µï¼š

- åˆ›å»ºé˜¶æ®µ
- æ‰§è¡Œé˜¶æ®µ

**1.åˆ›å»ºé˜¶æ®µ**

åˆ†ä¸º3éƒ¨åˆ†ï¼š

- 1ã€ç¡®å®š **this** çš„å€¼ï¼Œä¹Ÿè¢«ç§°ä¸º **This Binding**ã€‚
- 2ã€**LexicalEnvironmentï¼ˆè¯æ³•ç¯å¢ƒï¼‰** ç»„ä»¶è¢«åˆ›å»ºã€‚
- 3ã€**VariableEnvironmentï¼ˆå˜é‡ç¯å¢ƒï¼‰** ç»„ä»¶è¢«åˆ›å»ºã€‚

**(1)This Binding**

- **å…¨å±€**æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œ`this` çš„å€¼æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­`this` çš„å€¼æŒ‡å‘ `window`å¯¹è±¡ï¼Œè€Œåœ¨`nodejs`ä¸­æŒ‡å‘è¿™ä¸ªæ–‡ä»¶çš„`module`å¯¹è±¡ã€‚
- **å‡½æ•°**æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œ`this` çš„å€¼å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€‚å…·ä½“æœ‰ï¼šé»˜è®¤ç»‘å®šã€éšå¼ç»‘å®šã€æ˜¾å¼ç»‘å®šï¼ˆç¡¬ç»‘å®šï¼‰ã€`new`ç»‘å®šã€ç®­å¤´å‡½æ•°ï¼Œå…·ä½“å†…å®¹ä¼šåœ¨ã€thiså…¨é¢è§£æã€‘éƒ¨åˆ†è¯¦è§£ã€‚

**(2)è¯æ³•ç¯å¢ƒ**

åˆ†ä¸º2éƒ¨åˆ†ï¼š

- **ç¯å¢ƒè®°å½•**ï¼šå­˜å‚¨å˜é‡å’Œå‡½æ•°å£°æ˜çš„å®é™…ä½ç½®
- **å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨**ï¼šå¯ä»¥è®¿é—®å…¶å¤–éƒ¨è¯æ³•ç¯å¢ƒ

è¯æ³•ç¯å¢ƒæœ‰ä¸¤ç§**ç±»å‹**

- 1ã€**å…¨å±€ç¯å¢ƒ**ï¼šæ˜¯ä¸€ä¸ªæ²¡æœ‰å¤–éƒ¨ç¯å¢ƒçš„è¯æ³•ç¯å¢ƒï¼Œå…¶å¤–éƒ¨ç¯å¢ƒå¼•ç”¨ä¸º **null**ã€‚æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼ˆwindow å¯¹è±¡ï¼‰åŠå…¶å…³è”çš„æ–¹æ³•å’Œå±æ€§ï¼ˆä¾‹å¦‚æ•°ç»„æ–¹æ³•ï¼‰ä»¥åŠä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰çš„å…¨å±€å˜é‡ï¼Œ`this` çš„å€¼æŒ‡å‘è¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚
- 2ã€**å‡½æ•°ç¯å¢ƒ**ï¼šç”¨æˆ·åœ¨å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡è¢«å­˜å‚¨åœ¨**ç¯å¢ƒè®°å½•**ä¸­ï¼ŒåŒ…å«äº†`arguments` å¯¹è±¡ã€‚å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨å¯ä»¥æ˜¯å…¨å±€ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ…å«å†…éƒ¨å‡½æ•°çš„å¤–éƒ¨å‡½æ•°ç¯å¢ƒã€‚

**(3)å˜é‡ç¯å¢ƒ**

å˜é‡ç¯å¢ƒä¹Ÿæ˜¯ä¸€ä¸ªè¯æ³•ç¯å¢ƒï¼Œå› æ­¤å®ƒå…·æœ‰ä¸Šé¢å®šä¹‰çš„è¯æ³•ç¯å¢ƒçš„æ‰€æœ‰å±æ€§ã€‚

åœ¨ ES6 ä¸­ï¼Œ**è¯æ³•** ç¯å¢ƒå’Œ **å˜é‡** ç¯å¢ƒçš„åŒºåˆ«åœ¨äºå‰è€…ç”¨äºå­˜å‚¨**å‡½æ•°å£°æ˜å’Œå˜é‡ï¼ˆ `let` å’Œ `const` ï¼‰**ç»‘å®šï¼Œè€Œåè€…ä»…ç”¨äºå­˜å‚¨**å˜é‡ï¼ˆ `var` ï¼‰**ç»‘å®šã€‚



**2.æ‰§è¡Œé˜¶æ®µ**

å®Œæˆå¯¹æ‰€æœ‰å˜é‡çš„åˆ†é…ï¼Œæ‰§è¡Œä»£ç ï¼Œå‡½æ•°å‡ºæ ˆ

**å‚è€ƒ**

[ç†è§£ Javascript æ‰§è¡Œä¸Šä¸‹æ–‡å’Œæ‰§è¡Œæ ˆ](https://juejin.im/post/5bdfd3e151882516c6432c32)

## å˜é‡å¯¹è±¡

ä¾‹å­ä¸€ï¼š**å˜é‡æå‡**

```js
foo;  // undefined
var foo = function () {
    console.log('foo1');
}

foo();  // foo1ï¼Œfooèµ‹å€¼

var foo = function () {
    console.log('foo2');
}

foo(); // foo2ï¼Œfooé‡æ–°èµ‹å€¼
```

ä¾‹å­äºŒï¼š**å‡½æ•°æå‡**

```js
foo();  // foo2
function foo() {
    console.log('foo1');
}

foo();  // foo2

function foo() {
    console.log('foo2');
}

foo(); // foo2
```

ä¾‹å­ä¸‰ï¼šå£°æ˜ä¼˜å…ˆçº§ï¼Œ**å‡½æ•° > å˜é‡**

```js
foo();  // foo2
var foo = function() {
    console.log('foo1');
}

foo();  // foo1ï¼Œfooé‡æ–°èµ‹å€¼

function foo() {
    console.log('foo2');
}

foo(); // foo1
```

ä¸Šé¢ä¸‰ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªä¾‹å­æ˜¯å˜é‡æå‡ï¼Œç¬¬äºŒä¸ªä¾‹å­æ˜¯å‡½æ•°æå‡ï¼Œç¬¬ä¸‰ä¸ªä¾‹å­æ˜¯å‡½æ•°å£°æ˜ä¼˜å…ˆçº§é«˜äºå˜é‡å£°æ˜ã€‚

æœ‰å¦‚ä¸‹ä¸¤æ®µä»£ç ï¼Œæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸¤æ®µä»£ç ç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

```js
var scope = "global scope";
function checkscope(){
    var scope = "local scope";
    function f(){
        return scope;
    }
    return f();
}
checkscope();
var scope = "global scope";
function checkscope(){
    var scope = "local scope";
    function f(){
        return scope;
    }
    return f;
}
checkscope()();
```

ç­”æ¡ˆæ˜¯ æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„å˜åŒ–ä¸ä¸€æ ·ã€‚

ç¬¬ä¸€æ®µä»£ç ï¼š

```js
ECStack.push(<checkscope> functionContext);
ECStack.push(<f> functionContext);
ECStack.pop();
ECStack.pop();
```

ç¬¬äºŒæ®µä»£ç ï¼š

```js
ECStack.push(<checkscope> functionContext);
ECStack.pop();
ECStack.push(<f> functionContext);
ECStack.pop();
```

**è®¨è®ºé¢˜**

```
var a = {n: 1};
var b = a;
a.x = a = {n: 2};

a.x  // --> undefined
b.x  // --> {n: 2}
```

ç­”æ¡ˆå·²ç»å†™ä¸Šé¢äº†ï¼Œè¿™é“é¢˜çš„å…³é”®åœ¨äº

- 1ã€ä¼˜å…ˆçº§ã€‚`.`çš„ä¼˜å…ˆçº§é«˜äº`=`ï¼Œæ‰€ä»¥å…ˆæ‰§è¡Œ`a.x`ï¼Œå †å†…å­˜ä¸­çš„`{n: 1}`å°±ä¼šå˜æˆ`{n: 1, x: undefined}`ï¼Œæ”¹å˜ä¹‹åç›¸åº”çš„`b.x`ä¹Ÿå˜åŒ–äº†ï¼Œå› ä¸ºæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚
- 2ã€èµ‹å€¼æ“ä½œæ˜¯`ä»å³åˆ°å·¦`ï¼Œæ‰€ä»¥å…ˆæ‰§è¡Œ`a = {n: 2}`ï¼Œ`a`çš„å¼•ç”¨å°±è¢«æ”¹å˜äº†ï¼Œç„¶åè¿™ä¸ªè¿”å›å€¼åˆèµ‹å€¼ç»™äº†`a.x`ï¼Œ**éœ€è¦æ³¨æ„**çš„æ˜¯è¿™æ—¶å€™`a.x`æ˜¯ç¬¬ä¸€æ­¥ä¸­çš„`{n: 1, x: undefined}`é‚£ä¸ªå¯¹è±¡ï¼Œå…¶å®å°±æ˜¯`b.x`ï¼Œç›¸å½“äº`b.x = {n: 2}`

**å‚è€ƒ**

[JavaScriptæ·±å…¥ä¹‹å˜é‡å¯¹è±¡](https://github.com/mqyqingfeng/Blog/issues/5)

## å†…å­˜ç©ºé—´

JSå†…å­˜ç©ºé—´åˆ†ä¸º**æ ˆ(stack)**ã€**å †(heap)**ã€**æ± (ä¸€èˆ¬ä¹Ÿä¼šå½’ç±»ä¸ºæ ˆä¸­)**ã€‚ å…¶ä¸­**æ ˆ**å­˜æ”¾åŸºæœ¬å˜é‡ï¼Œ**å †**å­˜æ”¾åº”ç”¨å¯¹è±¡(å¼•ç”¨åœ°å€å­˜æ”¾åœ¨æ ˆï¼ŒçœŸå®å˜é‡åœ¨å †)ï¼Œ**æ± **å­˜æ”¾å¸¸é‡ï¼Œæ‰€ä»¥ä¹Ÿå«å¸¸é‡æ± ã€‚

**å‡ ä¸ªé—®é¢˜**

é—®é¢˜1ï¼š

```js
var a = 20;
var b = a;
b = 30;
// è¿™æ—¶açš„å€¼æ˜¯å¤šå°‘ï¼Ÿ
```

é—®é¢˜2ï¼š

```js
var a = { name: 'å‰ç«¯å¼€å‘' }
var b = a;
b.name = 'è¿›é˜¶';
// è¿™æ—¶a.nameçš„å€¼æ˜¯å¤šå°‘
```

é—®é¢˜3ï¼š

```js
var a = { name: 'å‰ç«¯å¼€å‘' }
var b = a;
a = null;
// è¿™æ—¶bçš„å€¼æ˜¯å¤šå°‘
```

ç°åœ¨æ¥è§£ç­”ä¸€ä¸‹ï¼Œä¸‰ä¸ªé—®é¢˜çš„ç­”æ¡ˆåˆ†åˆ«æ˜¯`20`ã€`â€˜è¿›é˜¶â€™`ã€`{ name: 'å‰ç«¯å¼€å‘' }`

- å¯¹äºé—®é¢˜1ï¼Œaã€béƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼Œå®ƒä»¬çš„å€¼æ˜¯å­˜å‚¨åœ¨æ ˆä¸­çš„ï¼Œaã€båˆ†åˆ«æœ‰å„è‡ªç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œæ‰€ä»¥ä¿®æ”¹äº†bçš„å€¼ä»¥åï¼Œaçš„å€¼å¹¶ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚
- å¯¹äºé—®é¢˜2ï¼Œaã€béƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ ˆå†…å­˜ä¸­å­˜æ”¾åœ°å€æŒ‡å‘å †å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå¼•ç”¨ç±»å‹çš„å¤åˆ¶ä¼šä¸ºæ–°çš„å˜é‡è‡ªåŠ¨åˆ†é…ä¸€ä¸ªæ–°çš„å€¼ä¿å­˜åœ¨å˜é‡å¯¹è±¡ä¸­ï¼Œä½†åªæ˜¯å¼•ç”¨ç±»å‹çš„ä¸€ä¸ªåœ°å€æŒ‡é’ˆè€Œå·²ï¼Œå®é™…æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä¿®æ”¹`b.name`çš„å€¼åï¼Œç›¸åº”çš„`a.name`ä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ã€‚
- å¯¹äºé—®é¢˜3ï¼Œé¦–å…ˆè¦è¯´æ˜çš„æ˜¯`null`æ˜¯åŸºæœ¬ç±»å‹ï¼Œ`a = null`ä¹‹ååªæ˜¯æŠŠaå­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­åœ°å€æ”¹å˜æˆäº†åŸºæœ¬ç±»å‹nullï¼Œå¹¶ä¸ä¼šå½±å“å †å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œæ‰€ä»¥bçš„å€¼ä¸å—å½±å“ã€‚

**JSçš„å†…å­˜ç”Ÿå‘½å‘¨æœŸ**

- 1ã€åˆ†é…ä½ æ‰€éœ€è¦çš„å†…å­˜
- 2ã€ä½¿ç”¨åˆ†é…åˆ°çš„å†…å­˜ï¼ˆè¯»ã€å†™ï¼‰
- 3ã€ä¸éœ€è¦æ—¶å°†å…¶é‡Šæ”¾ã€å½’è¿˜

# **ä»å†…å­˜æ¥çœ‹ null å’Œ undefined æœ¬è´¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ**

**è§£ç­”**ï¼š

ç»™ä¸€ä¸ªå…¨å±€å˜é‡èµ‹å€¼ä¸ºnullï¼Œç›¸å½“äºå°†è¿™ä¸ªå˜é‡çš„æŒ‡é’ˆå¯¹è±¡ä»¥åŠå€¼æ¸…ç©ºï¼Œå¦‚æœæ˜¯ç»™å¯¹è±¡çš„å±æ€§ èµ‹å€¼ä¸ºnullï¼Œæˆ–è€…å±€éƒ¨å˜é‡èµ‹å€¼ä¸ºnull,ç›¸å½“äºç»™è¿™ä¸ªå±æ€§åˆ†é…äº†ä¸€å—ç©ºçš„å†…å­˜ï¼Œç„¶åå€¼ä¸ºnullï¼Œ JSä¼šå›æ”¶å…¨å±€å˜é‡ä¸ºnullçš„å¯¹è±¡ã€‚

ç»™ä¸€ä¸ªå…¨å±€å˜é‡èµ‹å€¼ä¸ºundefinedï¼Œç›¸å½“äºå°†è¿™ä¸ªå¯¹è±¡çš„å€¼æ¸…ç©ºï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡ä¾æ—§å­˜åœ¨,å¦‚æœæ˜¯ç»™å¯¹è±¡çš„å±æ€§èµ‹å€¼ ä¸ºundefinedï¼Œè¯´æ˜è¿™ä¸ªå€¼ä¸ºç©ºå€¼

# é—­åŒ…

**å®šä¹‰**

é—­åŒ…æ˜¯æŒ‡æœ‰æƒè®¿é—®å¦å¤–ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡çš„å‡½æ•°ã€‚

å…³é”®åœ¨äº2ç‚¹ï¼š

- æ˜¯å‡½æ•°
- èƒ½å¤Ÿè®¿é—®å‡½æ•°ä½œç”¨åŸŸå¤–çš„å˜é‡

**ä¸‰ä¸ªç‰¹æ€§**

- é—­åŒ…å¯ä»¥è®¿é—®å½“å‰å‡½æ•°ä»¥å¤–çš„å˜é‡
- å³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»è¿”å›ï¼Œé—­åŒ…ä»èƒ½è®¿é—®å¤–éƒ¨å‡½æ•°å®šä¹‰çš„å˜é‡
- é—­åŒ…å¯ä»¥æ›´æ–°å¤–éƒ¨å˜é‡çš„å€¼

```
// é—­åŒ…å¯ä»¥è®¿é—®å½“å‰å‡½æ•°ä»¥å¤–çš„å˜é‡
function getOuter(){
  var date = '815';
  function getDate(str){
    console.log(str + date);  //è®¿é—®å¤–éƒ¨çš„date
  }
  return getDate('ä»Šå¤©æ˜¯ï¼š'); //"ä»Šå¤©æ˜¯ï¼š815"
}
getOuter();
// å³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»è¿”å›ï¼Œé—­åŒ…ä»èƒ½è®¿é—®å¤–éƒ¨å‡½æ•°å®šä¹‰çš„å˜é‡
function getOuter(){
  var date = '815';
  function getDate(str){
    console.log(str + date);  //è®¿é—®å¤–éƒ¨çš„date
  }
  return getDate;     //å¤–éƒ¨å‡½æ•°è¿”å›
}
var today = getOuter();
today('ä»Šå¤©æ˜¯ï¼š');   //"ä»Šå¤©æ˜¯ï¼š815"
today('æ˜å¤©ä¸æ˜¯ï¼š');   //"æ˜å¤©ä¸æ˜¯ï¼š815"
// é—­åŒ…å¯ä»¥æ›´æ–°å¤–éƒ¨å˜é‡çš„å€¼
function updateCount(){
  var count = 0;
  function getCount(val){
    count = val;
    console.log(count);
  }
  return getCount;     //å¤–éƒ¨å‡½æ•°è¿”å›
}
var count = updateCount();
count(815); //815
count(816); //816
```

**ä¸€ä¸ªç®€å•ä¾‹å­**

```
var scope = "global scope";
function checkscope(){
    var scope = "local scope";
    function f(){
        return scope;
    }
    return f;
}

var foo = checkscope(); // fooæŒ‡å‘å‡½æ•°f
foo();     // è°ƒç”¨å‡½æ•°f()
```

ç®€è¦çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

1. è¿›å…¥å…¨å±€ä»£ç ï¼Œåˆ›å»ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡**å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ**
2. å…¨å±€æ‰§è¡Œ**ä¸Šä¸‹æ–‡åˆå§‹åŒ–**
3. æ‰§è¡Œ checkscope å‡½æ•°ï¼Œåˆ›å»º checkscope å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œcheckscope æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ
4. checkscope æ‰§è¡Œ**ä¸Šä¸‹æ–‡åˆå§‹åŒ–**ï¼Œåˆ›å»ºå˜é‡å¯¹è±¡ã€ä½œç”¨åŸŸé“¾ã€thisç­‰
5. checkscope å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œcheckscope æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­å¼¹å‡º
6. æ‰§è¡Œ f å‡½æ•°ï¼Œåˆ›å»º f å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œf æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ
7. f æ‰§è¡Œ**ä¸Šä¸‹æ–‡åˆå§‹åŒ–**ï¼Œåˆ›å»ºå˜é‡å¯¹è±¡ã€ä½œç”¨åŸŸé“¾ã€thisç­‰
8. f å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œf å‡½æ•°ä¸Šä¸‹æ–‡ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­å¼¹å‡º

é‚£ä¹ˆ**é—®é¢˜**æ¥äº†ï¼Œ å‡½æ•°f æ‰§è¡Œçš„æ—¶å€™ï¼Œcheckscope å‡½æ•°ä¸Šä¸‹æ–‡å·²ç»è¢«é”€æ¯äº†ï¼Œé‚£å‡½æ•°fæ˜¯å¦‚ä½•è·å–åˆ°scopeå˜é‡çš„å‘¢ï¼Ÿ

> å‡½æ•°f æ‰§è¡Œä¸Šä¸‹æ–‡ç»´æŠ¤äº†ä¸€ä¸ªä½œç”¨åŸŸé“¾ï¼Œä¼šæŒ‡å‘æŒ‡å‘`checkscope`ä½œç”¨åŸŸã€‚
>
> æ‰€ä»¥æŒ‡å‘å…³ç³»æ˜¯å½“å‰ä½œç”¨åŸŸ --> `checkscope`ä½œç”¨åŸŸ--> å…¨å±€ä½œç”¨åŸŸï¼Œå³ä½¿ checkscopeContext è¢«é”€æ¯äº†ï¼Œä½†æ˜¯ JavaScript ä¾ç„¶ä¼šè®© checkscopeContext.AOï¼ˆæ´»åŠ¨å¯¹è±¡ï¼‰ æ´»åœ¨å†…å­˜ä¸­ï¼Œf å‡½æ•°ä¾ç„¶å¯ä»¥é€šè¿‡ f å‡½æ•°çš„ä½œç”¨åŸŸé“¾æ‰¾åˆ°å®ƒï¼Œè¿™å°±æ˜¯é—­åŒ…å®ç°çš„**å…³é”®**ã€‚

**ä¸€ä¸ªé—­åŒ…é¢˜**

```
var data = [];

for (var i = 0; i < 3; i++) {
  data[i] = function () {
    console.log(i);
  };
}

data[0]();
data[1]();
data[2]();
```

å¦‚æœçŸ¥é“é—­åŒ…çš„ï¼Œç­”æ¡ˆå°±å¾ˆæ˜æ˜¾äº†ï¼Œéƒ½æ˜¯3

å¦‚æœè¦ä¾æ¬¡è¾“å‡ºç´¢å¼•å€¼ï¼Œè§£å†³ï¼šæ”¹æˆé—­åŒ…ï¼Œæ–¹æ³•å°±æ˜¯`data[i]`è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è®¿é—®å˜é‡`i`

```
var data = [];

for (var i = 0; i < 3; i++) {
  data[i] = (function (i) {
      return function(){
          console.log(i);
      }
  })(i);
}

data[0](); // 0
data[1](); // 1
data[2](); // 2
```

å¾ªç¯ç»“æŸåçš„å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡æ²¡æœ‰å˜åŒ–ã€‚

æ‰§è¡Œ data[0] å‡½æ•°çš„æ—¶å€™ï¼Œdata[0] å‡½æ•°çš„ä½œç”¨åŸŸé“¾å‘ç”Ÿäº†æ”¹å˜ï¼šå› ä¸ºé—­åŒ…æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è´®å­˜äº†å˜é‡`i`ï¼Œæ‰€ä»¥æ ¹æ®ä½œç”¨åŸŸé“¾ä¼šåœ¨`globalContext.VO`ä¸­æŸ¥æ‰¾åˆ°å˜é‡`i`,å¹¶è¾“å‡º0ã€‚

**ä¸€ã€ä½œç”¨åŸŸ**

**1.å˜é‡æå‡**

```js
var scope="global";
function scopeTest(){
    console.log(scope);
    var scope="local"  
}
scopeTest(); //undefined
```

ä¸Šé¢çš„ä»£ç è¾“å‡ºæ˜¯`undefined`ï¼Œè¿™æ˜¯å› ä¸ºå±€éƒ¨å˜é‡`scope`å˜é‡æå‡äº†ï¼Œç­‰æ•ˆäºä¸‹é¢

```js
var scope="global";
function scopeTest(){
    var scope;
    console.log(scope);
    scope="local"  
}
scopeTest(); //undefined
```

**æ³¨æ„**ï¼Œå¦‚æœåœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­å¿˜è®°varï¼Œé‚£ä¹ˆå˜é‡å°±è¢«å£°æ˜ä¸ºå…¨å±€å˜é‡ã€‚

**2.æ²¡æœ‰å—çº§ä½œç”¨åŸŸ**

```js
var data = [];

for (var i = 0; i < 3; i++) {
  data[i] = function () {
    console.log(i);
  };
}

data[0](); // 3
data[1](); // 3
data[2](); // 3
```

**é—­åŒ…**

```
function createClosure(){
    var name = "jack";
    return {
        setStr:function(){
            name = "rose";
        },
        getStr:function(){
            return name + ":hello";
        }
    }
}
var builder = new createClosure();
builder.setStr();
console.log(builder.getStr()); //rose:hello
```

**é¢è¯•é¢˜**

ç”±äºä½œç”¨åŸŸé“¾æœºåˆ¶çš„å½±å“ï¼Œé—­åŒ…åªèƒ½å–å¾—å†…éƒ¨å‡½æ•°çš„æœ€åä¸€ä¸ªå€¼ï¼Œè¿™å¼•èµ·çš„ä¸€ä¸ªå‰¯ä½œç”¨å°±æ˜¯å¦‚æœå†…éƒ¨å‡½æ•°åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œé‚£ä¹ˆå˜é‡çš„å€¼å§‹ç»ˆä¸ºæœ€åä¸€ä¸ªå€¼ã€‚

å¦‚æœæƒ³ä»¥ä¸‹ä»£ç æŒ‰ç…§é¢„æœŸè¾“å‡ºç´¢å¼•å€¼ï¼Œæ€ä¹ˆåŠï¼Ÿ

```
var data = [];

for (var i = 0; i < 3; i++) {
  data[i] = function () {
    console.log(i);
  };
}

data[0](); // 3
data[1](); // 3
data[2](); // 3
```

**æ–¹æ³•1ï¼šç«‹å³æ‰§è¡Œå‡½æ•°**

```js
for (var i = 0; i < 3; i++) {
    (function(num) {
        setTimeout(function() {
            console.log(num);
        }, 1000);
    })(i);
}
// 0
// 1
// 2
```

**æ–¹æ³•2ï¼šè¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°èµ‹å€¼**

```js
var data = [];

for (var i = 0; i < 3; i++) {
  data[i] = (function (num) {
      return function(){
          console.log(num);
      }
  })(i);
}

data[0](); // 0
data[1](); // 1
data[2](); // 2
```

æ— è®ºæ˜¯**ç«‹å³æ‰§è¡Œå‡½æ•°**è¿˜æ˜¯**è¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°èµ‹å€¼**ï¼ŒåŸç†ä¸Šéƒ½æ˜¯å› ä¸ºå˜é‡çš„æŒ‰å€¼ä¼ é€’ï¼Œæ‰€ä»¥ä¼šå°†å˜é‡`i`çš„å€¼å¤åˆ¶ç»™å®å‚`num`ï¼Œåœ¨åŒ¿åå‡½æ•°çš„å†…éƒ¨åˆåˆ›å»ºäº†ä¸€ä¸ªç”¨äºè®¿é—®`num`çš„åŒ¿åå‡½æ•°ï¼Œè¿™æ ·æ¯ä¸ªå‡½æ•°éƒ½æœ‰äº†ä¸€ä¸ª`num`çš„å‰¯æœ¬ï¼Œäº’ä¸å½±å“äº†ã€‚

**æ–¹æ³•3ï¼šä½¿ç”¨ES6ä¸­çš„let**

```js
var data = [];

for (let i = 0; i < 3; i++) {
  data[i] = function () {
    console.log(i);
  };
}

data[0]();
data[1]();
data[2]();
```

è§£é‡Šä¸‹**åŸç†**ï¼š

```js
var data = [];// åˆ›å»ºä¸€ä¸ªæ•°ç»„data;

// è¿›å…¥ç¬¬ä¸€æ¬¡å¾ªç¯
{ 
 let i = 0; // æ³¨æ„ï¼šå› ä¸ºä½¿ç”¨letä½¿å¾—forå¾ªç¯ä¸ºå—çº§ä½œç”¨åŸŸ
            // æ­¤æ¬¡ let i = 0 åœ¨è¿™ä¸ªå—çº§ä½œç”¨åŸŸä¸­ï¼Œè€Œä¸æ˜¯åœ¨å…¨å±€ç¯å¢ƒä¸­
    data[0] = function() {
     console.log(i);
 };
}
```

# Newä¸€ä¸ªå¯¹è±¡å‘ç”Ÿäº†ä»€ä¹ˆ

**æ¨¡æ‹Ÿå®ç°**

å½“ä»£ç  `new Foo(...)` æ‰§è¡Œæ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹äº‹æƒ…ï¼š

1. ä¸€ä¸ªç»§æ‰¿è‡ª `Foo.prototype` çš„æ–°å¯¹è±¡è¢«åˆ›å»ºã€‚
2. ä½¿ç”¨æŒ‡å®šçš„å‚æ•°è°ƒç”¨æ„é€ å‡½æ•° `Foo` ï¼Œå¹¶å°† `this` ç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚`new Foo` ç­‰åŒäº `new Foo()`ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æŒ‡å®šå‚æ•°åˆ—è¡¨ï¼Œ`Foo` ä¸å¸¦ä»»ä½•å‚æ•°è°ƒç”¨çš„æƒ…å†µã€‚
3. ç”±æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡å°±æ˜¯ `new` è¡¨è¾¾å¼çš„ç»“æœã€‚å¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰æ˜¾å¼è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä½¿ç”¨æ­¥éª¤1åˆ›å»ºçš„å¯¹è±¡ã€‚

**æ¨¡æ‹Ÿå®ç°ç¬¬ä¸€æ­¥**

`new` æ˜¯å…³é”®è¯ï¼Œä¸å¯ä»¥ç›´æ¥è¦†ç›–ã€‚è¿™é‡Œä½¿ç”¨ `create` æ¥æ¨¡æ‹Ÿå®ç° `new` çš„æ•ˆæœã€‚

`new` è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œé€šè¿‡ `obj.__proto__ = Con.prototype` ç»§æ‰¿æ„é€ å‡½æ•°çš„åŸå‹ï¼ŒåŒæ—¶é€šè¿‡ `Con.apply(obj, arguments)`è°ƒç”¨çˆ¶æ„é€ å‡½æ•°å®ç°ç»§æ‰¿ï¼Œè·å–æ„é€ å‡½æ•°ä¸Šçš„å±æ€§ï¼ˆã€è¿›é˜¶3-3æœŸã€‘ï¼‰ã€‚

å®ç°ä»£ç å¦‚ä¸‹

```js
// ç¬¬ä¸€ç‰ˆ
function create() {
 // åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡
    var obj = new Object(),
 // è·å¾—æ„é€ å‡½æ•°ï¼Œargumentsä¸­å»é™¤ç¬¬ä¸€ä¸ªå‚æ•°
    Con = [].shift.call(arguments);
 // é“¾æ¥åˆ°åŸå‹ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§
    obj.__proto__ = Con.prototype;
 // ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§
    Con.apply(obj, arguments);
 // è¿”å›å¯¹è±¡
    return obj;
};
```

æµ‹è¯•ä¸€ä¸‹

```js
// æµ‹è¯•ç”¨ä¾‹
function Car(color) {
    this.color = color;
}
Car.prototype.start = function() {
    console.log(this.color + " car start");
}

var car = create(Car, "black");
car.color;
// black

car.start();
// black car start
```

å®Œç¾ï¼

**æ¨¡æ‹Ÿå®ç°ç¬¬äºŒæ­¥**

ä¸Šé¢çš„ä»£ç å·²ç»å®ç°äº† 80%ï¼Œç°åœ¨ç»§ç»­ä¼˜åŒ–ã€‚

æ„é€ å‡½æ•°è¿”å›å€¼æœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š

- 1ã€è¿”å›ä¸€ä¸ªå¯¹è±¡
- 2ã€æ²¡æœ‰ `return`ï¼Œå³è¿”å› `undefined`
- 3ã€è¿”å›`undefined` ä»¥å¤–çš„åŸºæœ¬ç±»å‹

**æƒ…å†µ1**ï¼šè¿”å›ä¸€ä¸ªå¯¹è±¡

```js
function Car(color, name) {
    this.color = color;
    return {
        name: name
    }
}

var car = new Car("black", "BMW");
car.color;
// undefined

car.name;
// "BMW"
```

å®ä¾‹ `car` ä¸­åªèƒ½è®¿é—®åˆ°**è¿”å›å¯¹è±¡ä¸­çš„å±æ€§**ã€‚

**æƒ…å†µ2**ï¼šæ²¡æœ‰ `return`ï¼Œå³è¿”å› `undefined`

```js
function Car(color, name) {
    this.color = color;
}

var car = new Car("black", "BMW");
car.color;
// black

car.name;
// undefined
```

å®ä¾‹ `car` ä¸­åªèƒ½è®¿é—®åˆ°**æ„é€ å‡½æ•°ä¸­çš„å±æ€§**ï¼Œå’Œæƒ…å†µ1å®Œå…¨ç›¸åã€‚

**æƒ…å†µ3**ï¼šè¿”å›`undefined` ä»¥å¤–çš„åŸºæœ¬ç±»å‹

```js
function Car(color, name) {
    this.color = color;
    return "new car";
}

var car = new Car("black", "BMW");
car.color;
// black

car.name;
// undefined
```

å®ä¾‹ `car` ä¸­åªèƒ½è®¿é—®åˆ°**æ„é€ å‡½æ•°ä¸­çš„å±æ€§**ï¼Œå’Œæƒ…å†µ1å®Œå…¨ç›¸åï¼Œç»“æœç›¸å½“äºæ²¡æœ‰è¿”å›å€¼ã€‚

**æ‰€ä»¥**éœ€è¦åˆ¤æ–­ä¸‹è¿”å›çš„å€¼æ˜¯ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯å¯¹è±¡åˆ™è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œä¸ç„¶è¿”å›æ–°åˆ›å»ºçš„ `obj`å¯¹è±¡ã€‚

æ‰€ä»¥å®ç°ä»£ç å¦‚ä¸‹ï¼š

```js
// ç¬¬äºŒç‰ˆ
function create() {
 // 1ã€è·å¾—æ„é€ å‡½æ•°ï¼ŒåŒæ—¶åˆ é™¤ arguments ä¸­ç¬¬ä¸€ä¸ªå‚æ•°
    Con = [].shift.call(arguments);
 // 2ã€åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡å¹¶é“¾æ¥åˆ°åŸå‹ï¼Œobj å¯ä»¥è®¿é—®æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§
    var obj = Object.create(Con.prototype);
 // 3ã€ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§
    var ret = Con.apply(obj, arguments);
 // 4ã€ä¼˜å…ˆè¿”å›æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡
 return ret instanceof Object ? ret : obj;
};
```

# é«˜é˜¶å‡½æ•°-æŸ¯é‡ŒåŒ–

**ä¸€ã€å®šä¹‰**

å‡½æ•°æŸ¯é‡ŒåŒ–åˆå«éƒ¨åˆ†æ±‚å€¼ï¼Œç»´åŸºç™¾ç§‘ä¸­å¯¹æŸ¯é‡ŒåŒ– (Currying) çš„å®šä¹‰ä¸ºï¼š

> åœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å°†ä½¿ç”¨å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°è€Œä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚

ç”¨å¤§ç™½è¯æ¥è¯´å°±æ˜¯åªä¼ é€’ç»™å‡½æ•°ä¸€éƒ¨åˆ†å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªæ–°å‡½æ•°å»å¤„ç†å‰©ä¸‹çš„å‚æ•°ã€‚ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ä»‹ç»ä¸‹ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ add å‡½æ•°äº†ã€‚

```js
// æœ¨æ˜“æ¨
const add = (...args) => args.reduce((a, b) => a + b);

// ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œæ‰§è¡Œ add å‡½æ•°
add(1, 2) // 3

// å‡è®¾æˆ‘ä»¬å®ç°äº†ä¸€ä¸ª currying å‡½æ•°ï¼Œæ”¯æŒä¸€æ¬¡ä¼ å…¥ä¸€ä¸ªå‚æ•°
let sum = currying(add);
// å°è£…ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ–¹ä¾¿é‡ç”¨
let addCurryOne = sum(1);
addCurryOne(2) // 3
addCurryOne(3) // 4
```

**äºŒã€å®é™…åº”ç”¨**

- 1.å»¶è¿Ÿè®¡ç®—ï¼šéƒ¨åˆ†æ±‚å’Œï¼Œbindå‡½æ•°
- 2.åŠ¨æ€åˆ›å»ºå‡½æ•°ï¼šæ·»åŠ ç›‘å¬addEventã€æƒ°æ€§å‡½æ•°
- 3.å‚æ•°å¤ç”¨ï¼š

**1.å»¶è¿Ÿè®¡ç®—**

```
const add = (...args) => args.reduce((a, b) => a + b);

// ç®€åŒ–å†™æ³•
function currying(func) {
    const args = [];
    return function result(...rest) {
        if (rest.length === 0) {
          return func(...args);
        } else {
          args.push(...rest);
         return result;
        }
    }
}

const sum = currying(add);
sum(1,2)(3); // æœªçœŸæ­£æ±‚å€¼
sum(4);    // æœªçœŸæ­£æ±‚å€¼
sum();     // è¾“å‡º 10
```

**bindå‡½æ•°**

```
let obj = {
  name: 'muyiy'
}
const fun = function () {
  console.log(this.name);
}.bind(obj);

fun(); // muyiy

// bindåº•å±‚åŸå› ä¹Ÿæ˜¯æŸ¯é‡ŒåŒ–çš„å®ç°
Function.prototype.bind = function (context) {
    var self = this;
    // ç¬¬ 1 ä¸ªå‚æ•°æ˜¯æŒ‡å®šçš„ thisï¼Œæˆªå–ä¿å­˜ç¬¬ 1 ä¸ªä¹‹åçš„å‚æ•°
  // arr.slice(begin); å³ [begin, end]
    var args = Array.prototype.slice.call(arguments, 1); 

    return function () {
        // æ­¤æ—¶çš„ arguments æ˜¯æŒ‡ bind è¿”å›çš„å‡½æ•°è°ƒç”¨æ—¶æ¥æ”¶çš„å‚æ•°
        // å³ return function çš„å‚æ•°ï¼Œå’Œä¸Šé¢é‚£ä¸ªä¸åŒ
       // ç±»æ•°ç»„è½¬æˆæ•°ç»„
        var bindArgs = Array.prototype.slice.call(arguments);
       // æ‰§è¡Œå‡½æ•°
        return self.apply( context, args.concat(bindArgs) );
    }
}
```

**2.åŠ¨æ€åˆ›å»ºå‡½æ•°**

æ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œä½†å…¶å®ç¬¬ä¸€æ¬¡åˆ¤æ–­è®¡ç®—ä¹‹åï¼Œåç»­è°ƒç”¨å¹¶ä¸éœ€è¦å†æ¬¡åˆ¤æ–­ã€‚è¿™ç§æƒ…å†µä¸‹å°±éå¸¸é€‚åˆä½¿ç”¨æŸ¯é‡ŒåŒ–æ–¹æ¡ˆæ¥å¤„ç†

```js
// ç®€åŒ–å†™æ³•
function addEvent (type, el, fn, capture = false) {
    if (window.addEventListener) {
        el.addEventListener(type, fn, capture);
    }
    else if(window.attachEvent){
        el.attachEvent('on' + type, fn);
    }
}
```

ä½†æ˜¯è¿™ç§å†™æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ¯æ¬¡æ·»åŠ äº‹ä»¶éƒ½ä¼šè°ƒç”¨åšä¸€æ¬¡åˆ¤æ–­ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•åªåˆ¤æ–­ä¸€æ¬¡å‘¢ï¼Œå¯ä»¥åˆ©ç”¨é—­åŒ…å’Œç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼‰æ¥å¤„ç†ã€‚

```js
const addEvent = (function(){
    if (window.addEventListener) {
        return function (type, el, fn, capture) {
            el.addEventListener(type, fn, capture);
        }
    }
    else if(window.attachEvent){
        return function (type, el, fn) {
            el.attachEvent('on' + type, fn);
        }
    }
})();
```

ä¸Šé¢è¿™ç§å®ç°æ–¹æ¡ˆå°±æ˜¯ä¸€ç§å…¸å‹çš„æŸ¯é‡ŒåŒ–åº”ç”¨ï¼Œåœ¨ç¬¬ä¸€æ¬¡çš„ `if...else if...` åˆ¤æ–­ä¹‹åå®Œæˆéƒ¨åˆ†è®¡ç®—ï¼ŒåŠ¨æ€åˆ›å»ºæ–°çš„å‡½æ•°ç”¨äºå¤„ç†åç»­ä¼ å…¥çš„å‚æ•°ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ä¹‹åè°ƒç”¨å°±ä¸éœ€è¦å†æ¬¡è®¡ç®—äº†ã€‚

**å½“ç„¶å¯ä»¥ä½¿ç”¨æƒ°æ€§å‡½æ•°æ¥å®ç°**è¿™ä¸€åŠŸèƒ½ï¼ŒåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯é‡å†™å‡½æ•°ã€‚

```js
function addEvent (type, el, fn, capture = false) {
   // é‡å†™å‡½æ•°
    if (window.addEventListener) {
        addEvent = function (type, el, fn, capture) {
            el.addEventListener(type, fn, capture);
        }
    }
    else if(window.attachEvent){
        addEvent = function (type, el, fn) {
            el.attachEvent('on' + type, fn);
        }
    }
   // æ‰§è¡Œå‡½æ•°ï¼Œæœ‰å¾ªç¯çˆ†æ ˆé£é™©
   addEvent(type, el, fn, capture); 
}
```

ç¬¬ä¸€æ¬¡è°ƒç”¨ `addEvent` å‡½æ•°åï¼Œä¼šè¿›è¡Œä¸€æ¬¡ç¯å¢ƒåˆ¤æ–­ï¼Œåœ¨è¿™ä¹‹å `addEvent` å‡½æ•°è¢«é‡å†™ï¼Œæ‰€ä»¥ä¸‹æ¬¡è°ƒç”¨æ—¶å°±ä¸ä¼šå†æ¬¡åˆ¤æ–­ç¯å¢ƒï¼Œå¯ä»¥è¯´å¾ˆå®Œç¾äº†ã€‚

**3.å‚æ•°å¤ç”¨**

```
// æ”¹é€ å‰
function isArray(obj) { 
    return Object.prototype.toString.call(obj) === '[object Array]';
}
function isNumber(obj) {
    return Object.prototype.toString.call(obj) === '[object Number]';
}
[1, 2, 3].toString(); // "1,2,3"
'123'.toString(); // "123"

// æ”¹é€ å
const toStr = Function.prototype.call.bind(Object.prototype.toString);
toStr([1, 2, 3]);  // "[object Array]"
toStr('123');   // "[object String]"
```

**ä¸‰ã€å®ç° currying å‡½æ•°**

```js
function currying(fn, length) {
  length = length || fn.length;  // æ³¨é‡Š 1
  return function (...args) {   // æ³¨é‡Š 2
    return args.length >= length // æ³¨é‡Š 3
     ? fn.apply(this, args)   // æ³¨é‡Š 4
      : currying(fn.bind(this, ...args), length - args.length) // æ³¨é‡Š 5
  }
}

// Test
const fn = currying(function(a, b, c) {
    console.log([a, b, c]);
});

fn("a", "b", "c") // ["a", "b", "c"]
fn("a", "b")("c") // ["a", "b", "c"]
fn("a")("b")("c") // ["a", "b", "c"]
fn("a")("b", "c") // ["a", "b", "c"]
```

- æ³¨é‡Š 1ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨è·å–å‡½æ•° fn å‚æ•°çš„é•¿åº¦ï¼Œåç»­è°ƒç”¨è·å– fn å‰©ä½™å‚æ•°çš„é•¿åº¦
- æ³¨é‡Š 2ï¼šcurrying åŒ…è£¹ä¹‹åè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œæ¥æ”¶å‚æ•°ä¸º `...args`
- æ³¨é‡Š 3ï¼šæ–°å‡½æ•°æ¥æ”¶çš„å‚æ•°é•¿åº¦æ˜¯å¦å¤§äºç­‰äº fn å‰©ä½™å‚æ•°éœ€è¦æ¥æ”¶çš„é•¿åº¦
- æ³¨é‡Š 4ï¼šæ»¡è¶³è¦æ±‚ï¼Œæ‰§è¡Œ fn å‡½æ•°ï¼Œä¼ å…¥æ–°å‡½æ•°çš„å‚æ•°
- æ³¨é‡Š 5ï¼šä¸æ»¡è¶³è¦æ±‚ï¼Œé€’å½’ currying å‡½æ•°ï¼Œæ–°çš„ fn ä¸º `bind` è¿”å›çš„æ–°å‡½æ•°ï¼ˆ`bind` ç»‘å®šäº† `...args` å‚æ•°ï¼Œæœªæ‰§è¡Œï¼‰ï¼Œæ–°çš„ length ä¸º fn å‰©ä½™å‚æ•°çš„é•¿åº¦

# Vue3.0å…¥é—¨_3

## ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–

æ•´ä½“æ¥çœ‹ï¼Œå˜åŒ–ä¸å¤§ï¼Œåªæ˜¯åå­—å¤§éƒ¨åˆ†éœ€è¦ + `on`ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼ã€‚ä½¿ç”¨ä¸Š Vue3 ç»„åˆå¼ API éœ€è¦å…ˆå¼•å…¥ï¼›Vue2 é€‰é¡¹ API åˆ™å¯ç›´æ¥è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

| Vue2.x        | Vue3            |
| :------------ | :-------------- |
| beforeCreate  | Not needed*     |
| created       | Not needed*     |
| beforeMount   | onBeforeMount   |
| mounted       | onMounted       |
| beforeUpdate  | onBeforeUpdate  |
| updated       | onUpdated       |
| beforeDestroy | onBeforeUnmount |
| destroyed     | onUnmounted     |

**Tipsï¼š** `setup`æ˜¯å›´ç»•`beforeCreate`å’Œ`created`ç”Ÿå‘½å‘¨æœŸé’©å­è¿è¡Œçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦æ˜¾å¼åœ°å»å®šä¹‰ã€‚

## å¤šæ ¹èŠ‚ç‚¹

Vue3 æ”¯æŒäº†å¤šæ ¹èŠ‚ç‚¹ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯`fragment`ã€‚

Vue2ä¸­ï¼Œç¼–å†™é¡µé¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å»å°†ç»„ä»¶åŒ…è£¹åœ¨`<div>`ä¸­ï¼Œå¦åˆ™æŠ¥é”™è­¦å‘Š

## å¼‚æ­¥ç»„ä»¶

Vue3 æä¾› `Suspense`ç»„ä»¶ï¼Œå…è®¸ç¨‹åºåœ¨ç­‰å¾…å¼‚æ­¥ç»„ä»¶æ—¶æ¸²æŸ“å…œåº•çš„å†…å®¹ï¼Œå¦‚ loading ï¼Œä½¿ç”¨æˆ·ä½“éªŒæ›´å¹³æ»‘ã€‚ä½¿ç”¨å®ƒï¼Œéœ€åœ¨æ¨¡æ¿ä¸­å£°æ˜ï¼Œå¹¶åŒ…æ‹¬ä¸¤ä¸ªå‘½åæ’æ§½ï¼š`default`å’Œ`fallback`ã€‚`Suspense`ç¡®ä¿åŠ è½½å®Œå¼‚æ­¥å†…å®¹æ—¶æ˜¾ç¤ºé»˜è®¤æ’æ§½ï¼Œå¹¶å°†`fallback`æ’æ§½ç”¨ä½œåŠ è½½çŠ¶æ€ã€‚

```vue
<tempalte>
   <suspense>
     <template #default>
       <todo-list />
     </template>
     <template #fallback>
       <div>
         Loading...
       </div>
     </template>
   </suspense>
</template>
```

## Teleport

Vue3 æä¾›`Teleport`ç»„ä»¶å¯å°†éƒ¨åˆ†DOMç§»åŠ¨åˆ° Vue appä¹‹å¤–çš„ä½ç½®ã€‚æ¯”å¦‚é¡¹ç›®ä¸­å¸¸è§çš„`Dialog`ç»„ä»¶ã€‚

```vue
<button @click=dialogVisible = true>ç‚¹å‡»</button>
<teleport to=body>
   <div class=dialog v-if=dialogVisible>
   </div>
</teleport>
```

## ç»„åˆå¼API

Vue2 æ˜¯ `é€‰é¡¹å¼APIï¼ˆOption APIï¼‰`ï¼Œä¸€ä¸ªé€»è¾‘ä¼šæ•£ä¹±åœ¨æ–‡ä»¶ä¸åŒä½ç½®ï¼ˆdataã€propsã€computedã€watchã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç­‰ï¼‰ï¼Œå¯¼è‡´ä»£ç çš„å¯è¯»æ€§å˜å·®ï¼Œéœ€è¦ä¸Šä¸‹æ¥å›è·³è½¬æ–‡ä»¶ä½ç½®ã€‚Vue3 `ç»„åˆå¼APIï¼ˆComposition APIï¼‰`åˆ™å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯å°†åŒä¸€é€»è¾‘çš„å†…å®¹å†™åˆ°ä¸€èµ·ã€‚è§£å†³äº† Vue2 `Mixin`çš„å­˜åœ¨çš„å‘½åå†²çªå’Œæ•°æ®æ¥æºä¸æ¸…ï¼Œä¸åŒç»„ä»¶é—´é…ç½®åŒ–ä½¿ç”¨ä¸å¤Ÿçµæ´»ã€‚

é™¤äº†å¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§ã€å†…èšæ€§ï¼Œç»„åˆå¼API è¿˜æä¾›äº†è¾ƒä¸ºå®Œç¾çš„é€»è¾‘å¤ç”¨æ€§æ–¹æ¡ˆï¼Œä¸¾ä¸ªğŸŒ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºå…¬ç”¨é¼ æ ‡åæ ‡æ¡ˆä¾‹ã€‚

```js
// main.vue
<template>
  <span>mouse position {{x}} {{y}}</span>
</template>
<script setup>
import { ref } from  vue 
import useMousePosition from  ./useMousePosition 
const {x, y} = useMousePosition()
}
</script>

// useMousePosition.js
import { ref, onMounted, onUnmounted } from  vue 
function useMousePosition() {
  let x = ref(0)
  let y = ref(0)
  function update(e) {
    x.value = e.pageX
    y.value = e.pageY
  }
  onMounted(() => {
    window.addEventListener( mousemove , update)
  })
  onUnmounted(() => {
    window.removeEventListener( mousemove , update)
  })
  return {
    x,
    y
  }
}
</script>
```

## å“åº”å¼åŸç†

Vue2 å“åº”å¼åŸç†åŸºç¡€æ˜¯`Object.defineProperty`ï¼›Vue3 å“åº”å¼åŸç†åŸºç¡€æ˜¯`Proxy`ã€‚

### Object.defineProperty

åŸºæœ¬ç”¨æ³•ï¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰æ–°çš„å±æ€§æˆ–ä¿®æ”¹ç°æœ‰çš„å±æ€§ï¼Œå¹¶è¿”å›å¯¹è±¡ã€‚
**Tipsï¼š** `writable` å’Œ `value` ä¸ `getter` å’Œ `setter` ä¸å…±å­˜ã€‚

```js
let obj = {}
let name =  ç‘¾è¡Œ 
Object.defineProperty(obj,  name , {
  enumerable: true, // å¯æšä¸¾ï¼ˆæ˜¯å¦å¯é€šè¿‡for...in æˆ– Object.keys()è¿›è¡Œè®¿é—®ï¼‰
  configurable: true, // å¯é…ç½®ï¼ˆæ˜¯å¦å¯ä½¿ç”¨deleteåˆ é™¤ï¼Œæ˜¯å¦å¯å†æ¬¡è®¾ç½®å±æ€§ï¼‰
  // value:   , // ä»»æ„ç±»å‹çš„å€¼ï¼Œé»˜è®¤undefined
  // writable: true, // å¯é‡å†™
  get: function() {
    return name
  },
  set: function(value) {
    name = value
  }
})
```

Vue2æ ¸å¿ƒæºç 

```js
function defineReactive(obj, key, val) {
  // ä¸€ key ä¸€ä¸ª dep
  const dep = new Dep()
  
  // è·å– key çš„å±æ€§æè¿°ç¬¦ï¼Œå‘ç°å®ƒæ˜¯ä¸å¯é…ç½®å¯¹è±¡çš„è¯ç›´æ¥ return
  const property = Object.getOwnPropertyDescriptor(obj, key)
  if (property && property.configurable === false) { return }
  
  // è·å– getter å’Œ setterï¼Œå¹¶è·å– val å€¼
  const getter = property && property.get
  const setter = property && property.set
  if((!getter || setter) && arguments.length === 2) { val = obj[key] }
  
  // é€’å½’å¤„ç†ï¼Œä¿è¯å¯¹è±¡ä¸­æ‰€æœ‰ key è¢«è§‚å¯Ÿ
  let childOb = observe(val)
  
  Object.defineProperty(obj, key, {
    enumerable: true,
    configurable: true,
    // get åŠ«æŒ obj[key] çš„ è¿›è¡Œä¾èµ–æ”¶é›†
    get: function reactiveGetter() {
      const value = getter ? getter.call(obj) : val
      if(Dep.target) {
        // ä¾èµ–æ”¶é›†
        dep.depend()
        if(childOb) {
          // é’ˆå¯¹åµŒå¥—å¯¹è±¡ï¼Œä¾èµ–æ”¶é›†
          childOb.dep.depend()
          // è§¦å‘æ•°ç»„å“åº”å¼
          if(Array.isArray(value)) {
            dependArray(value)
          }
        }
      }
    }
    return value
  })
  // set æ´¾å‘æ›´æ–° obj[key]
  set: function reactiveSetter(newVal) {
    ...
    if(setter) {
      setter.call(obj, newVal)
    } else {
      val = newVal
    }
    // æ–°å€¼è®¾ç½®å“åº”å¼
    childOb = observe(val)
    // ä¾èµ–é€šçŸ¥æ›´æ–°
    dep.notify()
  }
}
```

Vue2å“åº”å¼ç¼ºé™·ï¼šæ— æ³•ç›‘å¬å¯¹è±¡æˆ–æ•°ç»„æ–°å¢ã€åˆ é™¤çš„å…ƒç´ ã€‚
Vue2 æ–¹æ¡ˆï¼šé’ˆå¯¹å¸¸ç”¨æ•°ç»„åŸå‹æ–¹æ³•`push`ã€`pop`ã€`shift`ã€`unshift`ã€`splice`ã€`sort`ã€`reverse`è¿›è¡Œäº†hackå¤„ç†ï¼›æä¾›`Vue.set`ç›‘å¬å¯¹è±¡/æ•°ç»„æ–°å¢å±æ€§ã€‚å¯¹è±¡çš„æ–°å¢/åˆ é™¤å“åº”ï¼Œè¿˜å¯ä»¥`new`ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¢åˆ™åˆå¹¶æ–°å±æ€§å’Œæ—§å¯¹è±¡ï¼›åˆ é™¤åˆ™å°†åˆ é™¤å±æ€§åçš„å¯¹è±¡æ·±æ‹·è´ç»™æ–°å¯¹è±¡ã€‚

### Proxy

`Proxy`æ˜¯ES6æ–°ç‰¹æ€§ï¼Œé€šè¿‡ç¬¬2ä¸ªå‚æ•°`handler`æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºã€‚ç›¸è¾ƒäº`Object.defineProperty`æä¾›è¯­è¨€å…¨èŒƒå›´çš„å“åº”èƒ½åŠ›ï¼Œæ¶ˆé™¤äº†å±€é™æ€§ã€‚

åŸºæœ¬ç”¨æ³•ï¼šåˆ›å»ºå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰æ“ä½œã€‚

 Vue3 çš„æºç  reactive.ts 

```js
function createReactiveObject(target, isReadOnly, baseHandlers, collectionHandlers, proxyMap) {
  ...
  // collectionHandlers: å¤„ç†Mapã€Setã€WeakMapã€WeakSet
  // baseHandlers: å¤„ç†æ•°ç»„ã€å¯¹è±¡
  const proxy = new Proxy(
    target,
    targetType === TargetType.COLLECTION ? collectionHandlers : baseHandlers
  )
  proxyMap.set(target, proxy)
  return proxy
}
```

å¦‚baseHandlers.ts ä¸ºä¾‹ï¼Œä½¿ç”¨Reflect.getè€Œä¸æ˜¯`target[key]`çš„åŸå› æ˜¯receiverå‚æ•°å¯ä»¥æŠŠthisæŒ‡å‘getterè°ƒç”¨æ—¶ï¼Œè€ŒéProxyæ„é€ æ—¶çš„å¯¹è±¡ã€‚

```js
// ä¾èµ–æ”¶é›†
function createGetter(isReadonly = false, shallow = false) {
  return function get(target: Target, key: string | symbol, receiver: object) {
    ...
    // æ•°ç»„ç±»å‹
    const targetIsArray = isArray(target)
    if (!isReadonly && targetIsArray && hasOwn(arrayInstrumentations, key)) {
      return Reflect.get(arrayInstrumentations, key, receiver)
    }
    // éæ•°ç»„ç±»å‹
    const res = Reflect.get(target, key, receiver);
    
    // å¯¹è±¡é€’å½’è°ƒç”¨
    if (isObject(res)) {
      return isReadonly ? readonly(res) : reactive(res)
    }

    return res
  }
}
// æ´¾å‘æ›´æ–°
function createSetter() {
  return function set(target: Target, key: string | symbol, value: unknown, receiver: Object) {
    value = toRaw(value)
    oldValue = target[key]
    // å›  ref æ•°æ®åœ¨ set value æ—¶å°±å·² trigger ä¾èµ–äº†ï¼Œæ‰€ä»¥ç›´æ¥èµ‹å€¼ return å³å¯
    if (!isArray(target) && isRef(oldValue) && !isRef(value)) {
      oldValue.value = value
      return true
    }

    // å¯¹è±¡æ˜¯å¦æœ‰ key æœ‰ key setï¼Œæ—  key add
    const hadKey = hasOwn(target, key)
    const result = Reflect.set(target, key, value, receiver)
    
    if (target === toRaw(receiver)) {
      if (!hadKey) {
        trigger(target, TriggerOpTypes.ADD, key, value)
      } else if (hasChanged(value, oldValue)) {
        trigger(target, TriggerOpTypes.SET, key, value, oldValue)
      }
    }
    return result
  }
}
```

## è™šæ‹ŸDOM

Vue3 ç›¸æ¯”äº Vue2 è™šæ‹ŸDOM ä¸Šå¢åŠ `patchFlag`å­—æ®µã€‚æˆ‘ä»¬å€ŸåŠ©`Vue3 Template Explorer`æ¥çœ‹ã€‚

```html
<div id=app>
  <h1>æŠ€æœ¯æ‘¸é±¼</h1>
  <p>ä»Šå¤©å¤©æ°”çœŸä¸é”™</p>
  <div>{{name}}</div>
</div>
```

æ¸²æŸ“å‡½æ•°å¦‚ä¸‹:

```js
import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from vue

const _withScopeId = n => (_pushScopeId(scope-id),n=n(),_popScopeId(),n)
const _hoisted_1 = { id: app }
const _hoisted_2 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(h1, null, æŠ€æœ¯æ‘¸é±¼, -1 /* HOISTED */))
const _hoisted_3 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(p, null, ä»Šå¤©å¤©æ°”çœŸä¸é”™, -1 /* HOISTED */))

export function render(_ctx, _cache, $props, $setup, $data, $options) {
  return (_openBlock(), _createElementBlock(div, _hoisted_1, [
    _hoisted_2,
    _hoisted_3,
    _createElementVNode(div, null, _toDisplayString(_ctx.name), 1 /* TEXT */)
  ]))
}
```

æ³¨æ„ç¬¬ 3 ä¸ª`_createElementVNode`çš„ç¬¬ 4 ä¸ªå‚æ•°å³`patchFlag`å­—æ®µç±»å‹ï¼Œå­—æ®µç±»å‹æƒ…å†µå¦‚ä¸‹æ‰€ç¤ºã€‚1 ä»£è¡¨èŠ‚ç‚¹ä¸ºåŠ¨æ€æ–‡æœ¬èŠ‚ç‚¹ï¼Œé‚£åœ¨ diff è¿‡ç¨‹ä¸­ï¼Œåªéœ€æ¯”å¯¹æ–‡æœ¬å¯¹å®¹ï¼Œæ— éœ€å…³æ³¨ classã€styleç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå‘ç°æ‰€æœ‰çš„é™æ€èŠ‚ç‚¹ï¼Œéƒ½ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡è¿›è¡Œ`é™æ€æå‡`ï¼Œå¯åœ¨é‡æ–°æ¸²æŸ“æ—¶ç›´æ¥å¼•ç”¨ï¼Œæ— éœ€é‡æ–°åˆ›å»ºã€‚

```js
export const enum PatchFlags { 
  TEXT = 1, // åŠ¨æ€æ–‡æœ¬å†…å®¹
  CLASS = 1 << 1, // åŠ¨æ€ç±»å
  STYLE = 1 << 2, // åŠ¨æ€æ ·å¼
  PROPS = 1 << 3, // åŠ¨æ€å±æ€§ï¼Œä¸åŒ…å«ç±»åå’Œæ ·å¼
  FULL_PROPS = 1 << 4, // å…·æœ‰åŠ¨æ€ key å±æ€§ï¼Œå½“ key æ”¹å˜ï¼Œéœ€è¦è¿›è¡Œå®Œæ•´çš„ diff æ¯”è¾ƒ
  HYDRATE_EVENTS = 1 << 5, // å¸¦æœ‰ç›‘å¬äº‹ä»¶çš„èŠ‚ç‚¹
  STABLE_FRAGMENT = 1 << 6, // ä¸ä¼šæ”¹å˜å­èŠ‚ç‚¹é¡ºåºçš„ fragment
  KEYED_FRAGMENT = 1 << 7, // å¸¦æœ‰ key å±æ€§çš„ fragment æˆ–éƒ¨åˆ†å­èŠ‚ç‚¹
  UNKEYED_FRAGMENT = 1 << 8,  // å­èŠ‚ç‚¹æ²¡æœ‰ key çš„fragment
  NEED_PATCH = 1 << 9, // åªä¼šè¿›è¡Œé props çš„æ¯”è¾ƒ
  DYNAMIC_SLOTS = 1 << 10, // åŠ¨æ€çš„æ’æ§½
  HOISTED = -1,  // é™æ€èŠ‚ç‚¹ï¼Œdiffé˜¶æ®µå¿½ç•¥å…¶å­èŠ‚ç‚¹
  BAIL = -2 // ä»£è¡¨ diff åº”è¯¥ç»“æŸ
}
```

## äº‹ä»¶ç¼“å­˜

Vue3 çš„ `cacheHandler`å¯åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åç¼“å­˜æˆ‘ä»¬çš„äº‹ä»¶ã€‚ç›¸æ¯”äº Vue2 æ— éœ€æ¯æ¬¡æ¸²æŸ“éƒ½ä¼ é€’ä¸€ä¸ªæ–°å‡½æ•°ã€‚åŠ ä¸€ä¸ª`click`äº‹ä»¶ã€‚

```html
<div id=app>
  <h1>æŠ€æœ¯æ‘¸é±¼</h1>
  <p>ä»Šå¤©å¤©æ°”çœŸä¸é”™</p>
  <div>{{name}}</div>
  <span onCLick=() => {}><span>
</div>
```

æ¸²æŸ“å‡½æ•°å¦‚ä¸‹:

```js
import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from vue

const _withScopeId = n => (_pushScopeId(scope-id),n=n(),_popScopeId(),n)
const _hoisted_1 = { id: app }
const _hoisted_2 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(h1, null, æŠ€æœ¯æ‘¸é±¼, -1 /* HOISTED */))
const _hoisted_3 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(p, null, ä»Šå¤©å¤©æ°”çœŸä¸é”™, -1 /* HOISTED */))
const _hoisted_4 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(span, { onCLick: () => {} }, [
  /*#__PURE__*/_createElementVNode(span)
], -1 /* HOISTED */))

export function render(_ctx, _cache, $props, $setup, $data, $options) {
  return (_openBlock(), _createElementBlock(div, _hoisted_1, [
    _hoisted_2,
    _hoisted_3,
    _createElementVNode(div, null, _toDisplayString(_ctx.name), 1 /* TEXT */),
    _hoisted_4
  ]))
}
```

## Diff ä¼˜åŒ–

ç»“åˆä¸Šæ–‡ä¸æºç ï¼ŒpatchFlagå¸®åŠ© diff æ—¶åŒºåˆ†é™æ€èŠ‚ç‚¹ï¼Œä»¥åŠä¸åŒç±»å‹çš„åŠ¨æ€èŠ‚ç‚¹ã€‚ä¸€å®šç¨‹åº¦åœ°å‡å°‘èŠ‚ç‚¹æœ¬èº«åŠå…¶å±æ€§çš„æ¯”å¯¹ã€‚Vue3 patchChildren æºç :

```js
function patchChildren(n1, n2, container, parentAnchor, parentComponent, parentSuspense, isSVG, optimized) {
  // è·å–æ–°è€å­©å­èŠ‚ç‚¹
  const c1 = n1 && n1.children
  const c2 = n2.children
  const prevShapeFlag = n1 ? n1.shapeFlag : 0
  const { patchFlag, shapeFlag } = n2
  
  // å¤„ç† patchFlag å¤§äº 0 
  if(patchFlag > 0) {
    if(patchFlag && PatchFlags.KEYED_FRAGMENT) {
      // å­˜åœ¨ key
      patchKeyedChildren()
      return
    } els if(patchFlag && PatchFlags.UNKEYED_FRAGMENT) {
      // ä¸å­˜åœ¨ key
      patchUnkeyedChildren()
      return
    }
  }
  
  // åŒ¹é…æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼ˆé™æ€ï¼‰ï¼šç§»é™¤è€èŠ‚ç‚¹ï¼Œè®¾ç½®æ–‡æœ¬èŠ‚ç‚¹
  if(shapeFlag && ShapeFlags.TEXT_CHILDREN) {
    if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) {
      unmountChildren(c1 as VNode[], parentComponent, parentSuspense)
    }
    if (c2 !== c1) {
      hostSetElementText(container, c2 as string)
    }
  } else {
    // åŒ¹é…æ–°è€ Vnode æ˜¯æ•°ç»„ï¼Œåˆ™å…¨é‡æ¯”è¾ƒï¼›å¦åˆ™ç§»é™¤å½“å‰æ‰€æœ‰çš„èŠ‚ç‚¹
    if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) {
      if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {
        patchKeyedChildren(c1, c2, container, anchor, parentComponent, parentSuspense,...)
      } else {
        unmountChildren(c1 as VNode[], parentComponent, parentSuspense, true)
      }
    } else {
      
      if(prevShapeFlag & ShapeFlags.TEXT_CHILDREN) {
        hostSetElementText(container, )
      } 
      if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {
        mountChildren(c2 as VNodeArrayChildren, container,anchor,parentComponent,...)
      }
    }
  }
}
```

patchUnkeyedChildren æºç å¦‚ä¸‹ï¼š

```js
function patchUnkeyedChildren(c1, c2, container, parentAnchor, parentComponent, parentSuspense, isSVG, optimized) {
  c1 = c1 || EMPTY_ARR
  c2 = c2 || EMPTY_ARR
  const oldLength = c1.length
  const newLength = c2.length
  const commonLength = Math.min(oldLength, newLength)
  let i
  for(i = 0; i < commonLength; i++) {
    // å¦‚æœæ–° Vnode å·²ç»æŒ‚è½½ï¼Œåˆ™ç›´æ¥ clone ä¸€ä»½ï¼Œå¦åˆ™æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹
    const nextChild = (c2[i] = optimized ? cloneIfMounted(c2[i] as Vnode)) : normalizeVnode(c2[i])
    patch()
  }
  if(oldLength > newLength) {
    // ç§»é™¤å¤šä½™çš„èŠ‚ç‚¹
    unmountedChildren()
  } else {
    // åˆ›å»ºæ–°çš„èŠ‚ç‚¹
    mountChildren()
  }
}
```

patchKeyedChildrenæºç å¦‚ä¸‹ï¼Œæœ‰è¿ç”¨æœ€é•¿é€’å¢åºåˆ—çš„ç®—æ³•æ€æƒ³:

```js
function patchKeyedChildren(c1, c2, container, parentAnchor, parentComponent, parentSuspense, isSVG, optimized) {
  let i = 0;
  const e1 = c1.length - 1
  const e2 = c2.length - 1
  const l2 = c2.length
  
  // ä»å¤´å¼€å§‹éå†ï¼Œè‹¥æ–°è€èŠ‚ç‚¹æ˜¯åŒä¸€èŠ‚ç‚¹ï¼Œæ‰§è¡Œ patch æ›´æ–°å·®å¼‚ï¼›å¦åˆ™ï¼Œè·³å‡ºå¾ªç¯ 
  while(i <= e1 && i <= e2) {
    const n1 = c1[i]
    const n2 = c2[i]
    
    if(isSameVnodeType) {
      patch(n1, n2, container, parentAnchor, parentComponent, parentSuspense, isSvg, optimized)
    } else {
      break
    }
    i++
  }
  
  // ä»å°¾å¼€å§‹éå†ï¼Œè‹¥æ–°è€èŠ‚ç‚¹æ˜¯åŒä¸€èŠ‚ç‚¹ï¼Œæ‰§è¡Œ patch æ›´æ–°å·®å¼‚ï¼›å¦åˆ™ï¼Œè·³å‡ºå¾ªç¯ 
  while(i <= e1 && i <= e2) {
    const n1 = c1[e1]
    const n2 = c2[e2]
    if(isSameVnodeType) {
      patch(n1, n2, container, parentAnchor, parentComponent, parentSuspense, isSvg, optimized)
    } else {
      break
    }
    e1--
    e2--
  }
  
  // ä»…å­˜åœ¨éœ€è¦æ–°å¢çš„èŠ‚ç‚¹
  if(i > e1) {    
    if(i <= e2) {
      const nextPos = e2 + 1
      const anchor = nextPos < l2 ? c2[nextPos] : parentAnchor
      while(i <= e2) {
        patch(null, c2[i], container, parentAnchor, parentComponent, parentSuspense, isSvg, optimized)
      }
    }
  }
  
  // ä»…å­˜åœ¨éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹
  else if(i > e2) {
    while(i <= e1) {
      unmount(c1[i], parentComponent, parentSuspense, true)    
    }
  }
  
  // æ–°æ—§èŠ‚ç‚¹å‡æœªéå†å®Œ
  // [i ... e1 + 1]: a b [c d e] f g
  // [i ... e2 + 1]: a b [e d c h] f g
  // i = 2, e1 = 4, e2 = 5
  else {
    const s1 = i
    const s2 = i
    // ç¼“å­˜æ–° Vnode å‰©ä½™èŠ‚ç‚¹ ä¸Šä¾‹å³{e: 2, d: 3, c: 4, h: 5}
    const keyToNewIndexMap = new Map()
    for (i = s2; i <= e2; i++) {
      const nextChild = (c2[i] = optimized
          ? cloneIfMounted(c2[i] as VNode)
          : normalizeVNode(c2[i]))
      
      if (nextChild.key != null) {
        if (__DEV__ && keyToNewIndexMap.has(nextChild.key)) {
          warn(
            `Duplicate keys found during update:`,
             JSON.stringify(nextChild.key),
            `Make sure keys are unique.`
          )
        }
        keyToNewIndexMap.set(nextChild.key, i)
      }
    }
  }
  
  let j = 0
  // è®°å½•å³å°† patch çš„ æ–° Vnode æ•°é‡
  let patched = 0
  // æ–° Vnode å‰©ä½™èŠ‚ç‚¹é•¿åº¦
  const toBePatched = e2 - s2 + 1
  // æ˜¯å¦ç§»åŠ¨æ ‡è¯†
  let moved = false
  let maxNewindexSoFar = 0
  
  // åˆå§‹åŒ– æ–°è€èŠ‚ç‚¹çš„å¯¹åº”å…³ç³»ï¼ˆç”¨äºåç»­æœ€å¤§é€’å¢åºåˆ—ç®—æ³•ï¼‰
  const newIndexToOldIndexMap = new Array(toBePatched)
  for (i = 0; i < toBePatched; i++) newIndexToOldIndexMap[i] = 0
  
  // éå†è€ Vnode å‰©ä½™èŠ‚ç‚¹
  for (i = s1; i <= e1; i++) {
    const prevChild = c1[i]
    
    // ä»£è¡¨å½“å‰æ–° Vnode éƒ½å·²patchï¼Œå‰©ä½™æ—§ Vnode ç§»é™¤å³å¯
    if (patched >= toBePatched) {
      unmount(prevChild, parentComponent, parentSuspense, true)
      continue
    }
    
    let newIndex
    // æ—§ Vnode å­˜åœ¨ keyï¼Œåˆ™ä» keyToNewIndexMap è·å–
    if (prevChild.key != null) {
      newIndex = keyToNewIndexMap.get(prevChild.key)
    // æ—§ Vnode ä¸å­˜åœ¨ keyï¼Œåˆ™éå†æ–° Vnode è·å–
    } else {
      for (j = s2; j <= e2; j++) {
        if (newIndexToOldIndexMap[j - s2] === 0 && isSameVNodeType(prevChild, c2[j] as VNode)){
           newIndex = j
           break
        }
      }           
   }
   
   // åˆ é™¤ã€æ›´æ–°èŠ‚ç‚¹
   // æ–° Vnode æ²¡æœ‰ å½“å‰èŠ‚ç‚¹ï¼Œç§»é™¤
   if (newIndex === undefined) {
     unmount(prevChild, parentComponent, parentSuspense, true)
   } else {
     // æ—§ Vnode çš„ä¸‹æ ‡ä½ç½® + 1ï¼Œå­˜å‚¨åˆ°å¯¹åº” æ–° Vnode çš„ Map ä¸­
     // + 1 å¤„ç†æ˜¯ä¸ºäº†é˜²æ­¢æ•°ç»„é¦–ä½ä¸‹æ ‡æ˜¯ 0 çš„æƒ…å†µï¼Œå› ä¸ºè¿™é‡Œçš„ 0 ä»£è¡¨éœ€åˆ›å»ºæ–°èŠ‚ç‚¹
     newIndexToOldIndexMap[newIndex - s2] = i + 1
     
     // è‹¥ä¸æ˜¯è¿ç»­é€’å¢ï¼Œåˆ™ä»£è¡¨éœ€è¦ç§»åŠ¨
     if (newIndex >= maxNewIndexSoFar) {
       maxNewIndexSoFar = newIndex
     } else {
       moved = true
     }
     
     patch(prevChild,c2[newIndex],...)
     patched++
   }
  }
  
  // éå†ç»“æŸï¼ŒnewIndexToOldIndexMap = {0:5, 1:4, 2:3, 3:0}
  // æ–°å»ºã€ç§»åŠ¨èŠ‚ç‚¹
  const increasingNewIndexSequence = moved
  // è·å–æœ€é•¿é€’å¢åºåˆ—
  ? getSequence(newIndexToOldIndexMap)
  : EMPTY_ARR
  
  j = increasingNewIndexSequence.length - 1

  for (i = toBePatched - 1; i >= 0; i--) {
    const nextIndex = s2 + i
    const nextChild = c2[nextIndex] as VNode
    const anchor = extIndex + 1 < l2 ? (c2[nextIndex + 1] as VNode).el : parentAnchor
    // 0 æ–°å»º Vnode
    if (newIndexToOldIndexMap[i] === 0) {
      patch(null,nextChild,...)
    } else if (moved) {
      // ç§»åŠ¨èŠ‚ç‚¹
      if (j < 0 || i !== increasingNewIndexSequence[j]) {
        move(nextChild, container, anchor, MoveType.REORDER)
      } else {
        j--
      }
    }
  }
}
```

## æ‰“åŒ…ä¼˜åŒ–

> tree-shakingï¼šæ¨¡å—æ‰“åŒ…`webpack`ã€`rollup`ç­‰ä¸­çš„æ¦‚å¿µã€‚ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­æœªå¼•ç”¨çš„ä»£ç ã€‚ä¸»è¦ä¾èµ–äº`import`å’Œ`export`è¯­å¥ï¼Œç”¨æ¥æ£€æµ‹ä»£ç æ¨¡å—æ˜¯å¦è¢«å¯¼å‡ºã€å¯¼å…¥ï¼Œä¸”è¢« JavaScript æ–‡ä»¶ä½¿ç”¨ã€‚

ä»¥`nextTick`ä¸ºä¾‹å­ï¼Œåœ¨ Vue2 ä¸­ï¼Œå…¨å±€ API æš´éœ²åœ¨ Vue å®ä¾‹ä¸Šï¼Œå³ä½¿æœªä½¿ç”¨ï¼Œä¹Ÿæ— æ³•é€šè¿‡`tree-shaking`è¿›è¡Œæ¶ˆé™¤ã€‚

Vue3 ä¸­é’ˆå¯¹å…¨å±€ å’Œå†…éƒ¨çš„APIè¿›è¡Œäº†é‡æ„ï¼Œå¹¶è€ƒè™‘åˆ°`tree-shaking`çš„æ”¯æŒã€‚å› æ­¤ï¼Œå…¨å±€ API ç°åœ¨åªèƒ½ä½œä¸ºESæ¨¡å—æ„å»ºçš„å‘½åå¯¼å‡ºè¿›è¡Œè®¿é—®ã€‚

```
import { nextTick } from  vue 
nextTick(() => {
  // ä¸€äº›å’ŒDOMæœ‰å…³çš„ä¸œè¥¿
})
```

é€šè¿‡è¿™ä¸€æ›´æ”¹ï¼Œåªè¦æ¨¡å—ç»‘å®šå™¨æ”¯æŒ`tree-shaking`ï¼Œåˆ™ Vue åº”ç”¨ç¨‹åºä¸­æœªä½¿ç”¨çš„apiå°†ä»æœ€ç»ˆçš„æ†ç»‘åŒ…ä¸­æ¶ˆé™¤ï¼Œè·å¾—æœ€ä½³æ–‡ä»¶å¤§å°ã€‚å—æ­¤æ›´æ”¹å½±å“çš„å…¨å±€APIæœ‰å¦‚ä¸‹ã€‚

- Vue.nextTick
- Vue.observable ï¼ˆç”¨ Vue.reactive æ›¿æ¢ï¼‰
- Vue.version
- Vue.compile ï¼ˆä»…å…¨æ„å»ºï¼‰
- Vue.set ï¼ˆä»…å…¼å®¹æ„å»ºï¼‰
- Vue.delete ï¼ˆä»…å…¼å®¹æ„å»ºï¼‰

å†…éƒ¨ API ä¹Ÿæœ‰è¯¸å¦‚ transitionã€v-modelç­‰æ ‡ç­¾æˆ–è€…æŒ‡ä»¤è¢«å‘½åå¯¼å‡ºã€‚åªæœ‰åœ¨ç¨‹åºçœŸæ­£ä½¿ç”¨æ‰ä¼šè¢«æ†ç»‘æ‰“åŒ…ã€‚

æ ¹æ® å°¤å¤§ ç›´æ’­å¯ä»¥çŸ¥é“å¦‚ä»Š Vue3 å°†æ‰€æœ‰è¿è¡ŒåŠŸèƒ½æ‰“åŒ…ä¹Ÿåªæœ‰`22.5kb`ï¼Œæ¯” Vue2 è½»é‡å¾ˆå¤šã€‚

## è‡ªå®šä¹‰æ¸²æŸ“API

Vue3 æä¾›çš„`createApp`é»˜è®¤æ˜¯å°† template æ˜ å°„æˆ htmlã€‚ä½†è‹¥æƒ³ç”Ÿæˆ`canvas`æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨`custom renderer api`è‡ªå®šä¹‰renderç”Ÿæˆå‡½æ•°ã€‚

```js
// è‡ªå®šä¹‰runtime-renderå‡½æ•°
import { createApp } from  ./runtime-render 
import App from  ./src/App 
 
createApp(App).mount( #app )
```

## TypeScript æ”¯æŒ

Vue3 ç”±TSé‡å†™ï¼Œç›¸å¯¹äº Vue2 æœ‰æ›´å¥½åœ°`TypeScript`æ”¯æŒã€‚

- Vue2 `Option API`ä¸­ option æ˜¯ä¸ªç®€å•å¯¹è±¡ï¼Œè€ŒTSæ˜¯ä¸€ç§ç±»å‹ç³»ç»Ÿï¼Œé¢å‘å¯¹è±¡çš„è¯­æ³•ï¼Œä¸æ˜¯ç‰¹åˆ«åŒ¹é…ã€‚
- Vue2 éœ€è¦`vue-class-component`å¼ºåŒ–vueåŸç”Ÿç»„ä»¶ï¼Œä¹Ÿéœ€è¦`vue-property-decorator`å¢åŠ æ›´å¤šç»“åˆVueç‰¹æ€§çš„è£…é¥°å™¨ï¼Œå†™æ³•æ¯”è¾ƒç¹çã€‚

# è‡ªæ‰§è¡Œå‡½æ•°

**ä¸€ã€å‡½æ•°çš„å£°æ˜ä¸æ‰§è¡Œ**

å‡½æ•°ç”³æ˜æ–¹å¼

```
    // å£°æ˜å‡½æ•°fun0
    function fun0(){
        console.log("fun0");
    }

    //æ‰§è¡Œå‡½æ•°fun0
    fun0(); // fun0
```

å˜é‡èµ‹å€¼æ–¹å¼

```
    // å£°æ˜å‡½æ•°fun1 - å˜é‡æ–¹å¼
    var fun1 = function(){
        console.log("fun1");
    }

    // æ‰§è¡Œå‡½æ•°fun1
    fun1(); // fun1
```

**äºŒã€ å‡½æ•°çš„ä¸€ç‚¹çŒœæƒ³**

æ—¢ç„¶å‡½æ•°ååŠ ä¸Šæ‹¬å·`fun1()`å°±æ˜¯æ‰§è¡Œå‡½æ•°ã€‚ **æ€è€ƒï¼š**ç›´æ¥å–èµ‹å€¼ç¬¦å·å³ä¾§çš„å†…å®¹ç›´æ¥åŠ ä¸ªæ‹¬å·ï¼Œæ˜¯å¦ä¹Ÿèƒ½æ‰§è¡Œï¼Ÿ è¯•éªŒå¦‚ä¸‹ï¼Œç›´æ¥åŠ ä¸Šå°æ‹¬å¼§ï¼š

```javascript
    function(){
        console.log("fun");
    }();
```

ä»¥ä¸Šä¼šæŠ¥é”™ line1ï¼š`Uncaught SyntaxError: Unexpected token (`ã€‚ **åˆ†æï¼š** `function` æ˜¯å£°æ˜å‡½æ•°å…³é”®å­—ï¼Œè‹¥éå˜é‡èµ‹å€¼æ–¹å¼å£°æ˜å‡½æ•°ï¼Œé»˜è®¤å…¶åé¢éœ€è¦è·Ÿä¸Šå‡½æ•°åçš„ã€‚

åŠ ä¸Šå‡½æ•°åçœ‹çœ‹ï¼š

```javascript
    function fun2(){
        console.log("fun2");
    }();
```

ä»¥ä¸Šä¼šæŠ¥é”™ line3ï¼š`Uncaught SyntaxError: Unexpected token )`ã€‚ **åˆ†æï¼š** å£°æ˜å‡½æ•°çš„ç»“æ„èŠ±æ‹¬å¼§åé¢ä¸èƒ½æœ‰å…¶ä»–ç¬¦å·ï¼ˆæ¯”å¦‚æ­¤å¤„çš„å°æ‹¬å¼§ï¼‰ã€‚

ä¸æ­»å¿ƒçš„å†èƒ¡ä¹±è¯•ä¸€ä¸‹ï¼Œç»™å®ƒåŠ ä¸ªå®å‚ï¼ˆè¡¨è¾¾å¼ï¼‰ï¼š

```javascript
    function fun3(){
        console.log("fun3");
    }(1);
```

ä¸ä¼šæŠ¥é”™ï¼Œä½†ä¸ä¼šè¾“å‡ºç»“æœ`fun3`ã€‚ **åˆ†æï¼š** ä»¥ä¸Šä»£ç ç›¸å½“äºåœ¨å£°æ˜å‡½æ•°åï¼Œåˆå£°æ˜äº†ä¸€ä¸ªæ¯«æ— å…³ç³»çš„è¡¨è¾¾å¼ã€‚ç›¸å½“äºå¦‚ä¸‹ä»£ç å½¢å¼ï¼š

```javascript
    function fun3(){
        console.log("fun3");
    }

(1);

// è‹¥æ­¤å¤„æ‰§è¡Œfun3å‡½æ•°ï¼Œå¯ä»¥è¾“å‡ºç»“æœ
fun3(); //"fun3"
```

**ä¸‰ã€è‡ªæ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼**

**1. æ­£å„¿å…«ç»çš„è‡ªæ‰§è¡Œå‡½æ•°**

æƒ³è¦è§£å†³ä¸Šé¢é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å°æ‹¬å¼§å°†è¦æ‰§è¡Œçš„ä»£ç åŒ…å«ä½ï¼ˆæ–¹å¼ä¸€ï¼‰ï¼Œå¦‚ä¸‹ï¼š

```javascript
// æ–¹å¼ä¸€
    (function fun4(){
        console.log("fun4");
    }()); // "fun4"
```

**åˆ†æï¼š**å› ä¸ºåœ¨JavaScriptè¯­è¨€ä¸­ï¼Œ`()`é‡Œé¢ä¸èƒ½åŒ…å«è¯­å¥ï¼ˆåªèƒ½æ˜¯è¡¨è¾¾å¼ï¼‰ï¼Œæ‰€ä»¥è§£æå™¨åœ¨è§£æåˆ°`function`å…³é”®å­—çš„æ—¶å€™ï¼Œä¼šæŠŠå®ƒä»¬å½“ä½œfunctionè¡¨è¾¾å¼ï¼Œè€Œä¸æ˜¯æ­£å¸¸çš„å‡½æ•°å£°æ˜ã€‚ 

é™¤äº†ä¸Šé¢ç›´æ¥æ•´ä¸ªåŒ…å«ä½ï¼Œä¹Ÿå¯ä»¥åªåŒ…å«ä½å‡½æ•°ä½“ï¼ˆæ–¹å¼äºŒï¼‰ï¼Œå¦‚ä¸‹ï¼š

```javascript
// æ–¹å¼äºŒ
    (function fun5(){
        console.log("fun5");
    })();// "fun4"
```

å†™æ³•ä¸Šå»ºè®®é‡‡ç”¨æ–¹å¼ä¸€ï¼ˆè¿™æ˜¯å‚è€ƒæ–‡çš„å»ºè®®ã€‚ä½†å®é™…ä¸Šï¼Œæˆ‘ä¸ªäººè§‰å¾—æ–¹å¼äºŒæ¯”è¾ƒå¸¸è§ï¼‰ã€‚

**2. â€œæ­ªç“œè£‚æ£â€çš„è‡ªæ‰§è¡Œå‡½æ•°**

é™¤äº†ä¸Šé¢`()`å°æ‹¬å¼§å¯ä»¥æŠŠ`function`å…³é”®å­—ä½œä¸ºå‡½æ•°å£°æ˜çš„å«ä¹‰è½¬æ¢æˆå‡½æ•°è¡¨è¾¾å¼å¤–ï¼ŒJavaScriptçš„`&&` ä¸æ“ä½œã€`||`æˆ–æ“ä½œã€`,`é€—å·ç­‰æ“ä½œç¬¦ä¹Ÿæœ‰è¿™ä¸ªæ•ˆæœã€‚

```javascript
    true && function () { console.log("true &&") } (); // "true &&"
    false || function () { console.log("true ||") } (); // "true ||"
    0, function () { console.log("0,") } (); // "0,"

// æ­¤å¤„è¦æ³¨æ„ï¼š &&, || çš„çŸ­è·¯æ•ˆåº”ã€‚å³ï¼š false && (è¡¨è¾¾å¼1)  æ˜¯ä¸ä¼šè§¦å‘è¡¨è¾¾å¼1ï¼›
// åŒç†ï¼Œtrue || (è¡¨è¾¾å¼2) ä¸ä¼šè§¦å‘è¡¨è¾¾å¼2
```

å¦‚æœä¸åœ¨æ„è¿”å›å€¼ï¼Œä¹Ÿä¸åœ¨æ„ä»£ç çš„å¯è¯»æ€§ï¼Œæˆ‘ä»¬ç”šè‡³è¿˜å¯ä»¥ä½¿ç”¨ä¸€å…ƒæ“ä½œç¬¦ï¼ˆ`!` `~` `-` `+` ï¼‰ï¼Œå‡½æ•°åŒæ ·ä¹Ÿä¼šç«‹å³æ‰§è¡Œã€‚

```javascript
    !function () { console.log("!"); } (); //"!"
    ~function () { console.log("~"); } (); //"~"
    -function () { console.log("-"); } (); //"-"
    +function () { console.log("+"); } (); //"+"
```

ç”šè‡³è¿˜å¯ä»¥ä½¿ç”¨`new`å…³é”®å­—ï¼š

```javascript
// æ³¨æ„ï¼šé‡‡ç”¨newæ–¹å¼ï¼Œå¯ä»¥ä¸è¦å†è§£é‡ŠèŠ±æ‹¬å¼§ `}` åé¢åŠ å°æ‹¬å¼§ `()` 
new function () { console.log("new"); } //"new"

// å¦‚æœéœ€è¦ä¼ é€’å‚æ•°
new function (a) { console.log(a); } ("newwwwwwww"); //"newwwwwwww"
```

å—¯ï¼Œæœ€å¥½ç©çš„æ˜¯èµ‹å€¼ç¬¦å·`=`åŒæ ·ä¹Ÿæœ‰æ­¤æ•ˆç”¨ï¼ˆä¾‹å­ä¸­çš„`i`å˜é‡æ–¹å¼ï¼‰ï¼š

```javascript
//æ­¤å¤„ è¦æ³¨æ„åŒºåˆ† i å’Œ j ä¸åŒä¹‹å¤„ã€‚å‰è€…æ˜¯å‡½æ•°è‡ªæ‰§è¡Œåè¿”å›å€¼ç»™ i ï¼›åè€…æ˜¯å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°åä¸º j ã€‚
    var i = function () { console.log("output i:"); return 10; } (); // "output i:"
    var j = function () { console.log("output j:"); return 99;}
    console.log(i); // 10
    console.log(j); // Æ’ () { console.log("output j:"); return 99;}
```

ä¸Šé¢æåŠåˆ°ï¼Œè¦æ³¨æ„åŒºåˆ† `var i`å’Œ `var j` ä¸åŒä¹‹å¤„ï¼ˆå‰è€…æ˜¯å‡½æ•°è‡ªæ‰§è¡Œåè¿”å›å€¼ç»™`i` ï¼›åè€…æ˜¯å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°åä¸º`j`ï¼‰ã€‚å¦‚æœæ˜¯çœ‹ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ä»£ç ç»“å°¾æ˜¯å¦æœ‰æ²¡æœ‰`()`æ‰èƒ½åŒºåˆ†ã€‚ä¸€èˆ¬ä¸ºäº†æ–¹ä¾¿å¼€å‘äººå‘˜é˜…è¯»ï¼Œæˆ‘ä»¬ä¼šé‡‡ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ï¼š

```javascript
    var i2 = (function () { console.log("output i2:"); return 10; } ()); // "output i2:"
    var i3 = (function () { console.log("output i3:"); return 10; }) (); // "output i3:"
// ä»¥ä¸Šä¸¤ç§éƒ½å¯ä»¥ï¼Œä½†ä¾æ—§å»ºè®®é‡‡ç”¨ç¬¬ä¸€ç§ i2 çš„æ–¹å¼ã€‚ï¼ˆä¸ªäººä¾æ—§å–œæ¬¢ç¬¬äºŒç§i3æ–¹å¼ï¼‰
```

**å››ã€è‡ªæ‰§è¡Œå‡½æ•°çš„åº”ç”¨**

**1. forå¾ªç¯ + setTimeout ä¾‹å­**

å› ä¸ºæ˜¯å…¨å±€å˜é‡ï¼Œæ‰€ä»¥è¾“å‡ºéƒ½æ˜¯åŒä¸€ä¸ªå€¼

```
for( var i=0;i<3;i++){
    setTimeout(function(){
        console.log(i);
    }
    ,300);
}
// è¾“å‡ºç»“æœ 3,3,3
```

é‚£æ€ä¹ˆæ ·æ‰èƒ½è¾“å‡º`1,2,3`å‘¢ï¼Ÿ çœ‹çœ‹ä¸‹é¢çš„æ–¹å¼ï¼ˆå†™æ³•ä¸€ï¼‰ï¼šæŠŠ`setTimeout`ä»£ç åŒ…å«åœ¨åŒ¿åè‡ªæ‰§è¡Œå‡½æ•°é‡Œé¢ï¼Œå°±å¯ä»¥å®ç°â€œé”ä½â€ç´¢å¼•`i`ï¼Œæ­£å¸¸è¾“å‡ºç´¢å¼•å€¼ã€‚

```javascript
for( var i=0;i<3;i++){
    (function(lockedIndex){
        setTimeout(function(){
            console.log(lockedIndex);
        }
        ,300);
    })(i);
}
// è¾“å‡º "1,2,3"
```

**åˆ†æ**ï¼šå°½ç®¡å¾ªç¯æ‰§è¡Œç»“æŸï¼Œ`i`å€¼å·²ç»å˜æˆäº†3ã€‚ä½†å› é‡åˆ°äº†è‡ªæ‰§è¡Œå‡½æ•°ï¼Œå½“æ—¶çš„`i`å€¼å·²ç»è¢« `lockedIndex`é”ä½äº†ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸º è‡ªæ‰§è¡Œå‡½æ•°å±äºforå¾ªç¯ä¸€éƒ¨åˆ†ï¼Œæ¯æ¬¡éå†`i`ï¼Œè‡ªæ‰§è¡Œå‡½æ•°ä¹Ÿä¼šç«‹å³æ‰§è¡Œã€‚æ‰€ä»¥å°½ç®¡æœ‰å»¶æ—¶å™¨ï¼Œä½†ä¾æ—§ä¼šä¿ç•™ä½ç«‹å³æ‰§è¡Œæ—¶çš„`i`å€¼ã€‚ *ä¸Šé¢çš„åˆ†ææœ‰ç‚¹æ¨¡ç³Šå’Œç‰µå¼ºï¼Œä¹Ÿå¯ä»¥ä»* ***é—­åŒ…\*** *è§’åº¦å‡ºå‘åˆ†æçš„ã€‚*

é™¤äº†ä¸Šé¢çš„å†™æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ `setTimeout` ç¬¬ä¸€ä¸ªå‚æ•°åšè‡ªæ‰§è¡Œï¼ˆå†™æ³•äºŒï¼‰ï¼Œå¦‚ä¸‹ï¼š

```javascript
for( var i=0;i<3;i++){
    setTimeout((function(lockedInIndex){
        console.log(lockedInIndex);
    })(i)
    ,300);
}
```

```js
// 1. lockedInIndexå˜é‡ï¼Œä¹Ÿå¯ä»¥æ¢æˆiï¼Œå› ä¸ºå’Œå¤–é¢çš„iä¸åœ¨ä¸€ä¸ªä½œç”¨åŸŸ
for( var i=0;i<3;i++){
    (function(i){
        setTimeout(function(){
            console.log(i); // 1,2,3
        }
        ,300);
    })(i);
}

for( var i=0;i<3;i++){
    setTimeout((function(i){
        console.log(i); // 1,2,3
    })(i)
    ,300);
}

// 2. è‡ªæ‰§è¡Œå‡½æ•°ä¸å¸¦å…¥å‚æ•° 
for( var i=0;i<3;i++){
    (function(){
        setTimeout(function(){
            console.log(i); // 3,3,3
        }
        ,300);
    })();
}

for( var i=0;i<3;i++){
    setTimeout((function(){
        console.log(i); // 1,2,3
    })()
    ,300);
}

// 3. è‡ªæ‰§è¡Œå‡½æ•°åªæœ‰å®å‚æ²¡æœ‰å†™å½¢å‚
for( var i=0;i<3;i++){
    (function(){
        setTimeout(function(){
            console.log(i); // 3,3,3
        }
        ,300);
    })(i);
}

for( var i=0;i<3;i++){
    setTimeout((function(){
        console.log(i); // 1,2,3
    })(i)
    ,300);
}

// 4. è‡ªæ‰§è¡Œå‡½æ•°åªæœ‰å½¢å‚æ²¡æœ‰å†™å®å‚ï¼Œè¿™ç§æƒ…å†µä¸è¡Œã€‚å› ä¸ºä¼šå¯¼è‡´è¾“å‡º undefinedã€‚
for( var i=0;i<3;i++){
    (function(i){
        setTimeout(function(){
            console.log(i); // undefined,undefined,undefined
        }
        ,300);
    })();
}

for( var i=0;i<3;i++){
    setTimeout((function(i){
        console.log(i); // undefined,undefined,undefined
    })()
    ,300);
}
```



# ä»»èŒèµ„æ ¼

**å­—èŠ‚è·³åŠ¨**

1ã€æœ¬ç§‘åŠä»¥ä¸Šå­¦å†ï¼Œæ‰å®çš„è®¡ç®—æœºåŸºç¡€å’Œå‰ç«¯åŸºç¡€ï¼›
2ã€ç†Ÿç»ƒæŒæ¡React/Vueç­‰å¤§å‹å‰ç«¯æ¡†æ¶ï¼Œç†è§£åº•å±‚åŸç†ï¼Œèƒ½å¤Ÿçµæ´»è¿ç”¨ï¼›
3ã€äº†è§£è·¨å®¢æˆ·ç«¯/å…¨æ ˆ å…¶ä¸­çš„ä¸€ç§æŠ€æœ¯ä½“ç³»ï¼Œç†è§£ç›¸å…³åº•å±‚åŸç†ï¼›
4ã€ç†Ÿæ‚‰å‰ç«¯å·¥ç¨‹åŒ–ç›¸å…³åŠåŸç†ï¼Œå…·å¤‡è‰¯å¥½çš„æ¶æ„è®¾è®¡å’Œå·¥ç¨‹è®¾è®¡èƒ½åŠ›ï¼›
5ã€æœ‰å…¨æ ˆå®è·µï¼Œç†Ÿæ‚‰ Node/Python/Go åŠ åˆ†ï¼›
6ã€æœ‰è·¨ç«¯å¼€å‘ç»éªŒï¼ˆReact Native/Weex/Flutterï¼‰åŠ åˆ†ï¼›
7ã€æœ‰Webæ¸¸æˆå¼€å‘æˆ–å¼•æ“å¼€å‘ï¼ŒéŸ³è§†é¢‘ç›¸å…³å®è·µç»éªŒåŠ åˆ†ã€‚

# Z_Typoraå¸¸ç”¨ç”¨æ³•

## ä½å±‚çº§ç›®å½•

ä¸€ã€

1.

(1.)

a.

# ä¸€è¡Œä»£ç è®©ç½‘ç«™å˜æˆç°è‰²

```
// å°†å›¾åƒè½¬æ¢ä¸ºç°åº¦å›¾åƒã€‚å€¼å®šä¹‰è½¬æ¢çš„æ¯”ä¾‹ã€‚percent å€¼ä¸º 100% åˆ™å®Œå…¨è½¬ä¸ºç°åº¦å›¾åƒï¼Œå€¼ä¸º 0% å›¾åƒæ— å˜åŒ–ã€‚
filter: grayscale(100%)
```

# åä¸ºæœ¯è¯­

ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸç­–ç•¥GAåˆ°EOS,ä¸€èˆ¬GA->EOM->EOP->EOFS->EOSè¿‡ç¨‹ã€‚

1ï¼ŒGAï¼šå‘å¸ƒï¼Œé€šç”¨å¯è·å¾—æ€§ï¼›

2ï¼ŒEOMï¼šåœæ­¢é”€å”®å³åœæ­¢æ¥å•ï¼ŒEnd of Marketingï¼›

å•æ¿/éƒ¨ä»¶EOMï¼šåœæ­¢æ¥å—å•æ¿ã€éƒ¨ä»¶è®¢å•ï¼ˆåŒ…æ‹¬æ–°å»ºè®¢å•ã€æ‰©å®¹å’Œå¤‡ä»¶è®¢å•ï¼‰ï¼›
äº§å“EOMï¼šåœæ­¢æ¥å—è¯¥äº§å“çš„è®¢å•ï¼ˆåŒ…æ‹¬æ–°å»ºè®¢å•å’Œæ‰©å®¹è®¢å•ï¼‰ï¼›
ç‰ˆæœ¬EOMï¼šåœæ­¢æ¥å—è¯¥è½¯ä»¶ç‰ˆæœ¬çš„è®¢å•ï¼ˆåŒ…æ‹¬æ–°å»ºè®¢å•å’Œæ‰©å®¹è®¢å•ï¼‰ï¼›

3ï¼ŒEOPï¼šåœæ­¢ç”Ÿäº§ï¼ŒEnd of Productionï¼›

4ï¼ŒEOFSï¼šåœæ­¢å…¨é¢æ”¯æŒï¼ŒEnd of Full Support,å¯¹ç‰ˆæœ¬æ–°å‘ç°çš„ç¼ºé™·åœæ­¢ä¿®å¤ï¼Œä¸å†æä¾›æ–°çš„è¡¥ä¸ç‰ˆæœ¬ï¼Œå·²å‘ç°çš„ç¼ºé™·å°†ç»§ç»­è¿›è¡Œæ ¹å› åˆ†æå’Œä¿®å¤ã€‚

å•æ¿/éƒ¨ä»¶EOFS: è¯¥ç‚¹ä¹‹åå¯¹å®¢æˆ·æä¾›å•æ¿/éƒ¨ä»¶æœåŠ¡æ ‡å‡†é™ä½ï¼Œåœ¨EOFSæ—¥ä¹‹åï¼Œå¤‡ä»¶ç»´ä¿®æœåŠ¡ä¸ä¸ºå®¢æˆ·æä¾›ä¿®å¤ä¿è¯ï¼Œåªè§£å†³Critical å’Œ Major çº§åˆ«çš„é—®é¢˜ï¼›
ç‰ˆæœ¬EOFSï¼šå¯¹ç‰ˆæœ¬æ–°å‘ç°çš„ç¼ºé™·åœæ­¢ä¿®å¤ï¼Œä¸å†æä¾›æ–°çš„è¡¥ä¸ç‰ˆæœ¬ï¼Œå·²å‘ç°çš„ç¼ºé™·å°†ç»§ç»­è¿›è¡Œæ ¹å› åˆ†æå’Œä¿®å¤ï¼›

5ï¼ŒEOSï¼šåœæ­¢æœåŠ¡å’Œæ”¯æŒï¼ŒEnd of Service and Supportï¼Œä¸å†æä¾›é’ˆå¯¹è¯¥è½¯ä»¶ç‰ˆæœ¬çš„æœåŠ¡æ”¯æŒï¼Œåªèƒ½é€šè¿‡å‡çº§æ–°ç‰ˆæœ¬æ¥è§£å†³é—®é¢˜ã€‚

å•æ¿/éƒ¨ä»¶EOSï¼šæŒ‡ä»è¯¥æ—¥èµ·å¯ä¸å†æä¾›è¯¥å•æ¿/éƒ¨ä»¶ä»»ä½•æœåŠ¡ï¼›
äº§å“EOSï¼šä»è¯¥æ—¥èµ·ä¸å†æä¾›è¯¥äº§å“ä»»ä½•æœåŠ¡ï¼ŒåŒ…æ‹¬ç”µè¯æ”¯æŒï¼›
ç‰ˆæœ¬EOSï¼šä¸å†æä¾›ä»»ä½•æŠ€æœ¯æœåŠ¡æ”¯æŒï¼ŒåŒ…å«æ–°é—®é¢˜çš„å®šä½å’Œç¼ºé™·ä¿®å¤ï¼›

åœ¨EOFSã€EOSé˜¶æ®µå‡ºè¡¥ä¸éœ€è¦é€šè¿‡ä¾‹å¤–å¤‡æ¡ˆã€å®¡æ‰¹ã€‚

# å¦‚ä½•æˆä¸ºä¸€ä¸ªä¼˜ç§€çš„äºº

```
1.è¦é¡¾å…¨çš„å¤§å±€
  ä¸è¦ä¸ºäº†è‡ªå·±çš„ä¸€ç‚¹ç§å¿ƒå»åšäº‹ï¼Œå¤§å®¶å˜´ä¸Šä¸è¯´ä½†éƒ½çœ‹çš„åˆ°ã€‚å¤šäº†å¤§å±€å»è€ƒè™‘ï¼Œé¢†å¯¼å°±å–œæ¬¢è¿™æ ·çš„äººï¼Œä¹Ÿæ„¿æ„ææ‹”çˆ±é¡¾å¤§å±€çš„äººã€‚

2.åšäº‹ä¸å¤æ¿
  åœ¨å›¢é˜Ÿé‡Œéšæ—¶éƒ½èƒ½å‘ç”Ÿåº”æ€¥äº‹ä»¶ï¼Œéµå®ˆè§„åˆ™åˆ¶åº¦æ˜¯åº”è¯¥çš„ã€‚ä½†ä¸å¯äº‹äº‹å¤ªå¤æ¿ï¼Œè¦æ‡‚å¾—éšæœºåº”å˜ï¼Œæœ‰äº†å¤„ç†å¥½åº”æ€¥äº‹ä»¶çš„èƒ½åŠ›ã€‚

3.ä¸é€ƒé¿è´£ä»»
  åœ¨å‘ç”Ÿäº‹æ•…çš„æ—¶å€™ï¼Œä¸è¦é€ƒé¿è´£ä»»ï¼Œæ›´ä¸è¦ç»™è‡ªå·±æ‰¾å«èƒŒçš„ã€‚ä¼˜ç§€çš„äººæ‰éƒ½æ˜¯èƒ½å¤Ÿæ‰¿æ‹…è´£ä»»çš„ï¼Œäº‹æ•…ä¸å¯èƒ½æ€»æœ‰ï¼Œä¹Ÿä¸å¯èƒ½æ€»æ²¡æœ‰ï¼Œå¦‚æœæ¬¡æ¬¡éƒ½é€‰æ‹©é€ƒé¿ï¼Œè¿˜æ€ä¹ˆåšä¼˜ç§€
  äººç‰©ã€‚

4.æ„¿æ„å¸®åŠ©æ¯ä¸ªé˜Ÿå‘˜
  æ”¶æ‹¢äººå¿ƒå¾ˆè¦ï¼Œä½ èƒ½åŠ›å†å¼ºï¼Œåˆ«äººåˆä¸ºä»€ä¹ˆè¦é€‰ä½ å‘¢ï¼Œé‚£æ˜¯å› ä¸ºä½ èº«ä¸Šæœ‰é—ªå…‰ç‚¹ã€‚è€Œå¯¹é˜Ÿå‘˜æ¥è¯´ï¼Œä½ å¯¹å¤§å®¶ç»™äºˆçš„çœŸè¯šå¸®åŠ©ï¼Œå°±èƒ½å¸®ä½ èµ¢å¾—ä¸€å¤§ç‰‡äººå¿ƒã€‚

5.å–é•¿è¡¥çŸ­
  è¿™ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ¡ï¼Œä½ æ‹¥æœ‰äº†åˆ«äººä¸ä¼šçš„æŠ€æœ¯ï¼Œåˆæ˜¯å›¢é˜Ÿå¿…é¡»å…·å¤‡çš„æŠ€æœ¯ã€‚ä½ å°±æˆäº†æŠ€æœ¯éª¨å¹²äº†ï¼Œå¤šå»å­¦ä¹ åˆ«çš„é•¿å¤„ï¼Œå°†è‡ªèº«çš„çŸ­å¤„è¡¥é½ã€‚
```

# è‡ªåŠ¨åŒ–æµ‹è¯•

## æ€æƒ³å…ˆè¡Œ

**TDDï¼šTest-Driven Developmentï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰**

> TDD åˆ™è¦æ±‚åœ¨ç¼–å†™æŸä¸ªåŠŸèƒ½çš„ä»£ç ä¹‹å‰å…ˆç¼–å†™æµ‹è¯•ä»£ç ï¼Œç„¶ååªç¼–å†™ä½¿æµ‹è¯•é€šè¿‡çš„åŠŸèƒ½ä»£ç ï¼Œé€šè¿‡æµ‹è¯•æ¥æ¨åŠ¨æ•´ä¸ªå¼€å‘çš„è¿›è¡Œ

**BDDï¼šBehavior-Driven Developmentï¼ˆè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰**

> BDD å¯ä»¥è®©é¡¹ç›®æˆå‘˜ï¼ˆç”šè‡³æ˜¯ä¸æ‡‚ç¼–ç¨‹çš„ï¼‰ä½¿ç”¨è‡ªç„¶è¯­è¨€æ¥æè¿°ç³»ç»ŸåŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘ï¼Œä»è€Œæ ¹æ®è¿™äº›æè¿°æ­¥éª¤è¿›è¡Œç³»ç»Ÿè‡ªåŠ¨åŒ–çš„æµ‹è¯•

## ä¸ºä»€ä¹ˆè¦æµ‹è¯•ï¼Ÿ

- æé«˜ä»£ç è´¨é‡
- å‡†ç¡®å®šä½é—®é¢˜
- æ–¹ä¾¿è¿­ä»£/é‡æ„
- æœ€å¤§ç¨‹åº¦ä¿è¯äº§å“ç¬¦åˆé¢„æœŸ
- å‡å°‘å›å½’æµç¨‹
- æå‡å¼€å‘è€…ä¿¡å¿ƒå’Œå®‰å…¨æ„Ÿ

## æµ‹è¯•ç±»å‹æœ‰å“ªäº›ï¼Ÿ

- **å•å…ƒæµ‹è¯•ï¼ˆUnit Testï¼‰**
- **é›†æˆæµ‹è¯•ï¼ˆIntegration Testï¼‰**
- **UI æµ‹è¯•ï¼ˆUI Testï¼‰**

**å•å…ƒæµ‹è¯•ï¼ˆUnit Testï¼‰**

> å•å…ƒæµ‹è¯•æ˜¯æœ€å®¹æ˜“å®ç°çš„ï¼šä»£ç ä¸­å¤šä¸ªç»„ä»¶å…±ç”¨çš„å·¥å…·ç±»åº“ã€å¤šä¸ªç»„ä»¶å…±ç”¨çš„å­ç»„ä»¶ç­‰ã€‚
>
> **é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨å…¬å…±å‡½æ•°/ç»„ä»¶ä¸­ä¸€å®šè¦æœ‰å•å…ƒæµ‹è¯•æ¥ä¿è¯ä»£ç èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚å•å…ƒæµ‹è¯•ä¹Ÿåº”è¯¥æ˜¯é¡¹ç›®ä¸­æ•°é‡æœ€å¤šã€è¦†ç›–ç‡æœ€é«˜çš„ã€‚**
>
> èƒ½è¿›è¡Œå•å…ƒæµ‹è¯•çš„å‡½æ•°/ç»„ä»¶ï¼Œä¸€å®šæ˜¯ä½è€¦åˆçš„ï¼Œè¿™ä¹Ÿä»ä¸€å®šç¨‹åº¦ä¸Šä¿è¯äº†æˆ‘ä»¬çš„ä»£ç è´¨é‡ã€‚

**é›†æˆæµ‹è¯•ï¼ˆIntegration Testï¼‰**

> é›†æˆæµ‹è¯•é€šå¸¸è¢«åº”ç”¨åœ¨ï¼šè€¦åˆåº¦è¾ƒé«˜çš„å‡½æ•°/ç»„ä»¶ã€ç»è¿‡äºŒæ¬¡å°è£…çš„å‡½æ•°/ç»„ä»¶ã€å¤šä¸ªå‡½æ•°/ç»„ä»¶ç»„åˆè€Œæˆçš„å‡½æ•°/ç»„ä»¶ç­‰ã€‚
>
> é›†æˆæµ‹è¯•çš„ç›®çš„åœ¨äºï¼Œæµ‹è¯•ç»è¿‡å•å…ƒæµ‹è¯•åçš„å„ä¸ªæ¨¡å—ç»„åˆåœ¨ä¸€èµ·æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œã€‚ä¼šå¯¹ç»„åˆä¹‹åçš„ä»£ç æ•´ä½“æš´éœ²åœ¨å¤–æ¥å£è¿›è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹ç»„åˆåçš„ä»£ç å·¥ä½œæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

**UI æµ‹è¯•ï¼ˆUI Testï¼‰**

> UI æµ‹è¯•ï¼ˆUI Testï¼‰åªæ˜¯å¯¹äºå‰ç«¯çš„æµ‹è¯•ï¼Œæ˜¯è„±ç¦»çœŸå®åç«¯ç¯å¢ƒçš„ï¼Œä»…ä»…åªæ˜¯å°†å‰ç«¯æ”¾åœ¨çœŸå®ç¯å¢ƒä¸­è¿è¡Œï¼Œè€Œåç«¯å’Œæ•°æ®éƒ½åº”è¯¥ä½¿ç”¨ Mock çš„ã€‚
>
> UI æµ‹è¯•ï¼ˆUI Testï¼‰æ›´è´´è¿‘äºæˆ‘ä»¬çš„å¼€å‘æµç¨‹ã€‚åœ¨å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ä¸­ï¼Œå‰ç«¯å¼€å‘é€šå¸¸ä¼šä½¿ç”¨åˆ° Mock çš„æœåŠ¡å™¨å’Œæ•°æ®ã€‚å› è€Œæˆ‘ä»¬éœ€è¦åœ¨å¼€å‘åŸºæœ¬å®Œæˆåè¿›è¡Œç›¸åº”çš„ UI æµ‹è¯•ï¼ˆUI Testï¼‰ã€‚
>
> UI æµ‹è¯•çš„è‡ªåŠ¨åŒ–ç¨‹åº¦è¿˜ä¸é«˜ï¼Œå¤§å¤šæ•°è¿˜ä¾èµ–äºæ‰‹å·¥æµ‹è¯•ã€‚
>
> åœ¨ä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ä¸­æœ‰åˆ›å»ºå¿«ç…§çš„åŠŸèƒ½ï¼Œä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç° UI æµ‹è¯•ï¼ˆUI Testï¼‰çš„è‡ªåŠ¨åŒ–ã€‚

## å“ªäº›é¡¹ç›®é€‚åˆè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ

å¤§éƒ¨åˆ†çš„å¼€å‘éƒ½ä¼šè§‰å¾—ï¼šéœ€æ±‚è¿™ä¹ˆå¤šï¼Œè¿™ä¹ˆç´§æ€¥ï¼Œä¿è¯å®Œæˆéœ€æ±‚éƒ½å·²ç»éå¸¸å›°éš¾äº†ï¼Œå·²ç»æ²¡ç²¾åŠ›å†ç¼–å†™æµ‹è¯•ä»£ç äº†ã€‚

ç°å®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé’ˆå¯¹ä¸€äº›æ´»åŠ¨å¼€å‘ä¸€äº›ä¸€æ¬¡æ€§çš„ä»£ç æ¨¡å—ï¼Œè¿™æ ·çš„ä»£ç æ¨¡å—åŠŸèƒ½ç®€å•ï¼Œä¸”åç»­ç»§ç»­è¿­ä»£çš„å¯èƒ½æ€§ä½ï¼Œè¿™ç§ä»£ç å°±å®Œå…¨æ²¡æœ‰å¿…è¦å¼•å…¥è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ã€‚

**é€‚åˆå¼•å…¥è‡ªåŠ¨åŒ–æµ‹è¯•çš„åœºæ™¯ï¼š**

1. å…¬å…±åº“ç±»çš„å¼€å‘ç»´æŠ¤
2. ä¸­é•¿æœŸé¡¹ç›®çš„è¿­ä»£/é‡æ„
3. å¼•ç”¨äº†ä¸å¯æ§çš„ç¬¬ä¸‰æ–¹ä¾èµ–

è¿™äº›åœºæ™¯æ˜¯éœ€è¦å¼•å…¥è‡ªåŠ¨åŒ–æµ‹è¯•æ¥å¯¹ç°æœ‰ä»£ç è¿›è¡Œçº¦æŸçš„ã€‚**å°¤å…¶æ˜¯ä¸­é•¿æœŸé¡¹ç›®ï¼Œè¿­ä»£/é‡æ„æ—¶äººåŠ›å›å½’å›°éš¾ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼**

## æµ‹è¯•å·¥å…·æœ‰å“ªäº›ï¼Ÿ

- å•å…ƒæµ‹è¯•ï¼ˆUnit Testï¼‰æœ‰ Mocha, Ava, Karma, Jest, Jasmine ç­‰ã€‚
- é›†æˆæµ‹è¯•ï¼ˆIntegration Testï¼‰å’Œ UI æµ‹è¯•ï¼ˆUI Testï¼‰æœ‰ ReactTestUtils, Test Render, Enzyme, React-Testing-Library, Vue-Test-Utils ç­‰ã€‚

**Mocha**

> Mocha æ˜¯ç”Ÿæ€æœ€å¥½ï¼Œä½¿ç”¨æœ€å¹¿æ³›çš„å•æµ‹æ¡†æ¶ï¼Œä½†æ˜¯ä»–éœ€è¦è¾ƒå¤šçš„é…ç½®æ¥å®ç°å®ƒçš„é«˜æ‰©å±•æ€§ã€‚

**Ava**

> Ava æ˜¯æ›´è½»é‡é«˜æ•ˆç®€å•çš„å•æµ‹æ¡†æ¶ï¼Œä½†æ˜¯è‡ªèº«ä¸å¤Ÿç¨³å®šï¼Œå¹¶å‘è¿è¡Œæ–‡ä»¶å¤šçš„æ—¶å€™ä¼šæ’‘çˆ† CPUã€‚

**Jasmine**

> Jasmine æ˜¯å•æµ‹æ¡†æ¶çš„â€œå…ƒè€â€ï¼Œå¼€ç®±å³ç”¨ï¼Œä½†æ˜¯å¼‚æ­¥æµ‹è¯•æ”¯æŒè¾ƒå¼±ã€‚

**Jest**

> Jest åŸºäº Jasmine, åšäº†å¤§é‡ä¿®æ”¹å¹¶æ·»åŠ äº†å¾ˆå¤šç‰¹æ€§ï¼ŒåŒæ ·å¼€ç®±å³ç”¨ï¼Œä½†å¼‚æ­¥æµ‹è¯•æ”¯æŒè‰¯å¥½ã€‚

**Karma**

> Karma èƒ½åœ¨çœŸå®çš„æµè§ˆå™¨ä¸­æµ‹è¯•ï¼Œå¼ºå¤§é€‚é…å™¨ï¼Œå¯é…ç½®å…¶ä»–å•æµ‹æ¡†æ¶ï¼Œä¸€èˆ¬ä¼šé…åˆ Mocha æˆ– Jasmine ç­‰ä¸€èµ·ä½¿ç”¨ã€‚

æ¯ä¸ªæ¡†æ¶éƒ½æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œæ²¡æœ‰æœ€å¥½çš„æ¡†æ¶ï¼Œåªæœ‰æœ€é€‚åˆçš„æ¡†æ¶ã€‚

Vueå’ŒReact çš„é»˜è®¤æµ‹è¯•æ¡†æ¶æ˜¯ Jestï¼ŒAugular çš„é»˜è®¤æµ‹è¯•æ¡†æ¶å°±æ˜¯ Karma + Jasmine

# æ¨èä¹¦ç±

javascript domç¼–ç¨‹è‰ºæœ¯

javascripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆçº¢å®ä¹¦ï¼‰ å’Œjavascriptæƒå¨æŒ‡å—ï¼ˆçŠ€ç‰›ä¹¦ï¼‰

Vuejsè®¾è®¡ä¸å®ç°

javascriptå¿è€…ç§˜ç±

javascriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µ

å­¦ä¹ javascriptæ•°æ®ç»“æ„å’Œç®—æ³•

å‰ç«¯å¼€å‘æ ¸å¿ƒçŸ¥è¯†è¿›é˜¶

javascriptè¿·ä½ æ­£åˆ™ä¹¦

ä½ ä¸çŸ¥é“çš„javascript ï¼ˆå°é»„ä¹¦ï¼‰

Javascript20å‘¨å¹´ï¼ˆå†å²ä¹¦ï¼‰

javascriptè¯­è¨€ç²¾ç²¹ä¸ç¼–ç¨‹å®è·µ

å•Šå“ˆç®—æ³•ï¼Œå°ç°è¯´ç®—æ³•

# æ˜é‡‘å¤œè°ˆ-ç¬¬ä¸€æœŸå°¤é›¨æºªå¯¹è¯Vue

è§†é¢‘åœ°å€ï¼š[å°¤å¤§å¯¹è¯](https://live.juejin.cn/4354/vue3)

**å°¤å¯¹åæ§½**

å°¤å¯¹åæ§½ [React](https://so.csdn.net/so/search?q=React&spm=1001.2101.3001.7020) hooks çš„ç¼ºç‚¹ï¼šå¿ƒæ™ºè´Ÿæ‹…ï¼Œé—­åŒ…é™·é˜±ï¼ŒuseEffect çš„ä¾èµ–é¡¹ç­‰ç­‰.

å…¶å®ä¸ç„¶ã€‚

> é¦–å…ˆé—­åŒ…é™·é˜±çš„ç”±æ¥åœ¨äºå¤§å®¶å¯¹äºé—­åŒ…çš„ç†è§£ä¸å¤Ÿæ·±åˆ»ï¼Œå› æ­¤åœ¨ä½¿ç”¨éƒ¨åˆ† hooks çš„æ—¶å€™ï¼Œå¯¹äºæŸäº›é—­åŒ…çš„äº§ç”Ÿæ— æ³•æ„ŸçŸ¥åˆ°ã€‚å®é™…ä¸Šé—­åŒ…é™·é˜±çš„é€»è¾‘å¦‚æœæˆç«‹çš„è¯ï¼Œå¹¶ä¸ä»…ä»…å­˜åœ¨äº React hooks ä¸­ï¼Œè€Œæ˜¯å­˜åœ¨äº JavaScript çš„æ‰€æœ‰å¯èƒ½å‡ºç°çš„åœºæ™¯ã€‚ç‰¹åˆ«æ˜¯åŒ¿åå‡½æ•°è¿™ç§å¼±æ„ŸçŸ¥çš„åœºæ™¯ã€‚
>
> useEffect çš„ä¾èµ–é—®é¢˜å…¶å®åœ¨æˆ‘çœ‹æ¥ä¸ä»…ä¸æ˜¯ hooks çš„ç¼ºç‚¹ï¼Œåè€Œæ˜¯ hooks çš„ä¼˜ç‚¹ã€‚useEffect çš„ä¾èµ–é¡¹èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç›‘å¬å•ä¸€æ•°æ®ä»¥é©±åŠ¨å¤šä¸ªæ•°æ®ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©è¿™ä¸ªç‰¹æ€§å®Œæˆå•æ•°æ®é©±åŠ¨å¤šæ•°æ®ï¼Œå†ç”±å¤šæ•°æ®é©±åŠ¨ UI çš„å¼€å…³æ€ç»´ã€‚èƒ½å¤Ÿæå¤§çš„ç®€åŒ–æˆ‘ä»¬çš„å¼€å‘ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚

**Vue3å°–é”é—®é¢˜**

1.vue3 ä¸ ts çš„ç»“åˆ

 vue3 ä¸ ts çš„ç»“åˆä¸å¤Ÿå®Œå–„çš„äº‹æƒ…ã€‚ä¸»è¦æ˜¯ props çš„å®šä¹‰æ–¹å¼ä¸æ³›å‹ç»„ä»¶çš„é—®é¢˜ã€‚

> å°¤å¤§è§£é‡Šï¼šProps å€¼å®šä¹‰ç¡®å®æ˜¯ä¸€ä¸ªå…¼å®¹æ€§å¯¼è‡´çš„åŒ…è¢±ã€‚ä½†æ˜¯åœ¨ <script setup> ä¸‹å·²ç»æ”¯æŒç›´æ¥ç”¨ defineProps<{...}> ç±»å‹å£°æ˜ props äº†ï¼ˆè‡ªåŠ¨ç¼–è¯‘ä¸ºå¯¹åº”çš„å€¼å£°æ˜ï¼‰ã€‚

2.Vue3ä¸æ”¯æŒè·¨ç«¯

 Vue å›¢é˜Ÿæ²¡æœ‰ç²¾åŠ›å»åšè¿™äº›äº‹æƒ…ï¼Œåªæœ‰å…¬å¸çº§åˆ«çš„ä½“é‡æ‰æœ‰èƒ½åŠ›å»åšï¼Œå› ä¸ºè·¨ç«¯çš„æ”¯æŒç¡®å®å¾ˆå¤æ‚ã€‚

**Vue4æ–°å˜åŒ–**

vue ä¼šå€Ÿé‰´ solid çš„ç¼–è¯‘æ¨¡å¼ã€‚solid æ˜¯ä¸€ä¸ªæ‘ˆå¼ƒäº†è™šæ‹Ÿ DOMï¼Œèµ°ç¼–è¯‘å‹è·¯çº¿çš„æ¡†æ¶ï¼Œåˆ«çš„ä¸è¯´ï¼Œä»–çš„æ€§èƒ½æ˜¯èƒ½åŠæ‰“ç›®å‰çš„ Vue ä¸ Reactã€‚

**éƒ­è¾‰ï¼šä½ä»£ç ï¼Œæ— ä»£ç **

è´¢åŠ¡å…¬å¸(é‡‘è¶)åœ¨ä½ä»£ç åšå¾—éå¸¸æˆç†Ÿï¼Œä½†æ˜¯å‘¢ï¼Œå¤§å¤šæ•°å›¢é˜Ÿéƒ½åšå¾—ä¸æ˜¯å¾ˆå¥½ã€‚ä¸»è¦çš„åŸå› åœ¨äºè®¸å¤šåœºæ™¯ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œä¸é€šç”¨ï¼Œæ— æ³•æŠ½è±¡ã€‚ä¹Ÿå°±å¯¼è‡´äº†ä½ä»£ç çš„å®ç°æˆä¸ºäº†ä¸€ç§æ„¿æ™¯ã€‚

è®¸å¤šå›¢é˜Ÿåœ¨æ”»å…‹ç»„ä»¶æ¸²æŸ“è¿™ä¸€å±‚çš„ä¸œè¥¿ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™äº›éƒ½æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸æ˜¯é¡¹ç›®çš„æ ¸å¿ƒç—›ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéƒ­è€å¸ˆè§‰å¾—ä»–ä»¬çš„æ–¹å‘èµ°é”™äº†ã€‚

ä½ä»£ç ä»…ä»…åªé€‚åˆé€»è¾‘æŠ½è±¡æ¯”è¾ƒç®€å•ï¼Œæ¯”è¾ƒé€šç”¨çš„åœºæ™¯ã€‚ä¾‹å¦‚å‘ç¥¨ã€‚ä¸šåŠ¡é€»è¾‘æŠ½è±¡æ¯”è¾ƒå®¹æ˜“ã€‚toB çš„ä¸šåŠ¡é€»è¾‘æ˜¯æ— æ³•è§£å†³çš„ã€‚

# argså‰©ä½™å‚æ•°ä¸argumentså‡½æ•°å½¢å‚ç±»æ•°ç»„

**args**

å®šä¹‰ï¼šåªåŒ…å«é‚£äº›æ²¡æœ‰å¯¹åº”å½¢å‚çš„å®å‚ã€‚å°†æ‰€æœ‰åé¢å‰©ä½™çš„æ˜¯å®å‚ä¸ªæ•°åŒ…è£¹æˆä¸€ä¸ªæ•°ç»„ã€‚

- å±•å¼€è¿ç®—ç¬¦
- ç”¨äºè§£æ„èµ‹å€¼
- ç±»æ•°ç»„å¯¹è±¡å˜æˆæ•°ç»„

> **var** arr1=['a','b','c']; **var** arr2=['d','e'];arr1.**push**(...arr2)
>
> **let** b=[...new Set([1,2])]

**argumentså¯¹è±¡**

1.å®šä¹‰ï¼šåŒ…å«äº†ä¼ ç»™å‡½æ•°çš„æ‰€æœ‰å®å‚ã€‚åœ¨å‡½æ•°ä»£ç ä¸­ï¼Œä½¿ç”¨ç‰¹æ®Šå¯¹è±¡ `arguments`ï¼Œå¼€å‘è€…æ— éœ€æ˜ç¡®æŒ‡å‡ºå‚æ•°åï¼Œå°±èƒ½è®¿é—®å®ƒä»¬ã€‚å®ƒæ˜¯ä¸€ä¸ªç±»æ•°ç»„ï¼Œä¸æ˜¯æ•°ç»„ã€‚

```js
function test(a, b, c) {
  console.log(arguments) // Arguments(4) [1, 2, 3, 4, callee: Æ’, Symbol(Symbol.iterator): Æ’] 
  console.log(test.length) // 3
  console.log(arguments.callee.length) // 3
  console.log(Array.apply(null, arguments))
}

test(1,2,3,4)
å…¶ä¸­arguments ä»£è¡¨çš„æ˜¯å‡½æ•°å®å‚çš„ä¸ªæ•°
å…¶ä¸­fn.length ä»£è¡¨å‡½æ•°å½¢å‚çš„ä¸ªæ•°
å…¶ä¸­arguments.callee æŒ‡å‘å‡½æ•°æœ¬èº«
```

2.æå–å‚æ•°

```js
var args = Array.prototype.slice.call(arguments);
var args = [].slice.call(arguments);

// ES2015
const args = Array.from(arguments);
const args = [...arguments];
```

> **è­¦å‘Šï¼š** å¯¹å‚æ•°ä½¿ç”¨ slice ä¼šé˜»æ­¢æŸäº› JavaScript å¼•æ“ä¸­çš„ä¼˜åŒ– (æ¯”å¦‚ V8 - [æ›´å¤šä¿¡æ¯](https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#3-managing-arguments))ã€‚å¦‚æœä½ å…³å¿ƒæ€§èƒ½ï¼Œå°è¯•é€šè¿‡éå† arguments å¯¹è±¡æ¥æ„é€ ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨è¢«å¿½è§†çš„`Array`æ„é€ å‡½æ•°ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼š
>
> ```
> var args = (arguments.length === 1 ? [arguments[0]] : Array.apply(null, arguments));
> ```

3.ä¸€èˆ¬æ¨¡å¼å’Œä¸¥æ ¼æ¨¡å¼ä¸‹arguments

- ä¸€èˆ¬æ¨¡å¼ï¼šå¦‚æœç¼ºçœå‚æ•°ï¼Œargumentså’Œå‚æ•°æ˜¯éš”ç¦»å¼€çš„ï¼›å¦‚æœä¼ å…¥å‚æ•°ï¼Œargumentså’Œå‚æ•°æ˜¯åŒå‘ç»‘å®šçš„
- ä¸¥æ ¼æ¨¡å¼ï¼šargumentså’Œå‚æ•°æ˜¯åŒå‘ç»‘å®šçš„

(1)ä¸€èˆ¬æ¨¡å¼

ç›´æ¥ä¸Šä»£ç ï¼Œå…ˆæ¥çœ‹è°ƒç”¨æ—¶ç¼ºçœå‚æ•°çš„æƒ…å†µ

```
function a1(x) {
    x = 2;
    console.log(x, arguments[0]);
}
a1(); // 2 undefined

function a2(x) {
    arguments[0] = 2;
    console.log(x, arguments[0]);
}
a2(); // undefined 2
```

å†æ¥çœ‹è°ƒç”¨æ—¶ä¼ å…¥å‚æ•°çš„æƒ…å†µ

```
function a3(x) {
    x = 2;
    console.log(x, arguments[0]);
}
a3(1); // 2 2

function a4(x) {
    arguments[0] = 2;
    console.log(x, arguments[0]);
}
a4(1); // 2 2
```

å¯ä»¥çœ‹åˆ°å¦‚æœç¼ºçœå‚æ•°ï¼Œargumentså’Œå‚æ•°æ˜¯éš”ç¦»å¼€çš„ï¼›å¦‚æœä¼ å…¥å‚æ•°ï¼Œargumentså’Œå‚æ•°æ˜¯åŒå‘ç»‘å®šçš„ã€‚

(2)ä¸¥æ ¼æ¨¡å¼

å†æ¥çœ‹çœ‹ä¸¥æ ¼æ¨¡å¼ï¼Œç›´æ¥ä¸Šä»£ç 

```
function b1(x) {
    'use strict';
    x = 2;
    console.log(x, arguments[0]);
}
b1(); // 2 undefined

function b2(x) {
    'use strict';
    arguments[0] = 2;
    console.log(x, arguments[0]);
}
b2(); // undefined 2

function b3(x) {
    'use strict';
    x = 2;
    console.log(x, arguments[0]);
}
b3(1); // 2 1

function b4(x) {
    'use strict';
    arguments[0] = 2;
    console.log(x, arguments[0]);
}
b4(1); // 1 2
```

åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ— è®ºå‚æ•°æ˜¯å¦ç¼ºçœï¼Œargumentså’Œå‚æ•°éƒ½æ˜¯éš”ç¦»å¼€çš„ã€‚

# CJS, AMD, UMD å’Œ ESMæ˜¯ä»€ä¹ˆ

- ç”±äº `ESM` å…·æœ‰ç®€å•çš„è¯­æ³•ï¼Œå¼‚æ­¥ç‰¹æ€§å’Œå¯æ‘‡æ ‘æ€§ï¼Œå› æ­¤å®ƒæ˜¯æœ€å¥½çš„æ¨¡å—åŒ–æ–¹æ¡ˆ
- `UMD` éšå¤„å¯è§ï¼Œé€šå¸¸åœ¨ `ESM` ä¸èµ·ä½œç”¨çš„æƒ…å†µä¸‹ç”¨ä½œå¤‡ç”¨
- `CJS` æ˜¯åŒæ­¥çš„ï¼Œé€‚åˆåç«¯
- `AMD` æ˜¯å¼‚æ­¥çš„ï¼Œé€‚åˆå‰ç«¯

**1.CJS**

`CJS` æ˜¯ `CommonJS` çš„ç¼©å†™ã€‚ç»å¸¸æˆ‘ä»¬è¿™ä¹ˆä½¿ç”¨ï¼š

```javascript
// importing 
const doSomething = require('./doSomething.js'); 

// exporting
module.exports = function doSomething(n) {
  // do something
}
å¤åˆ¶ä»£ç 
```

- å¾ˆå¤šäººå¯ä»¥ä» `Node` ä¸­ç«‹åˆ»è®¤å‡º `CJS` çš„è¯­æ³•ã€‚è¿™æ˜¯å› ä¸º `Node` å°±æ˜¯ä½¿ç”¨ [`CJS` æ¨¡å—](https://link.juejin.cn?target=https%3A%2F%2Fblog.risingstack.com%2Fnode-js-at-scale-module-system-commonjs-require%2F)çš„
- `CJS` æ˜¯åŒæ­¥å¯¼å…¥æ¨¡å—
- ä½ å¯ä»¥ä» `node_modules` ä¸­å¼•å…¥ä¸€ä¸ªåº“æˆ–è€…ä»æœ¬åœ°ç›®å½•å¼•å…¥ä¸€ä¸ªæ–‡ä»¶ ã€‚å¦‚ `const myLocalModule = require('./some/local/file.js')` æˆ–è€… `var React = require('react');` ï¼Œéƒ½å¯ä»¥èµ·ä½œç”¨
- å½“ `CJS` å¯¼å…¥æ—¶ï¼Œå®ƒä¼šç»™ä½ ä¸€ä¸ªå¯¼å…¥å¯¹è±¡çš„å‰¯æœ¬
- `CJS` ä¸èƒ½åœ¨æµè§ˆå™¨ä¸­å·¥ä½œã€‚å®ƒå¿…é¡»ç»è¿‡è½¬æ¢å’Œæ‰“åŒ…

**2.AMD**

`AMD` ä»£è¡¨å¼‚æ­¥æ¨¡å—å®šä¹‰ã€‚

```js
define(['dep1', 'dep2'], function (dep1, dep2) {
    //Define the module value by returning a value.
    return function () {};
});
æˆ–è€…
define(function (require) {
    var dep1 = require('dep1'),
        dep2 = require('dep2');
    return function () {};
});
```

- `AMD` æ˜¯å¼‚æ­¥(`asynchronously`)å¯¼å…¥æ¨¡å—çš„(å› æ­¤å¾—å)
- ä¸€å¼€å§‹è¢«æè®®çš„æ—¶å€™ï¼Œ`AMD` æ˜¯ä¸ºå‰ç«¯è€Œåšçš„(è€Œ `CJS` æ˜¯åç«¯)
- `AMD` çš„è¯­æ³•ä¸å¦‚ `CJS` ç›´è§‚ã€‚æˆ‘è®¤ä¸º `AMD` å’Œ `CJS` å®Œå…¨ç›¸å

**3.UMD**

`UMD` ä»£è¡¨é€šç”¨æ¨¡å—å®šä¹‰ï¼ˆ`Universal Module Definition`ï¼‰

- åœ¨å‰ç«¯å’Œåç«¯éƒ½é€‚ç”¨ï¼ˆâ€œé€šç”¨â€å› æ­¤å¾—åï¼‰
- å…¼å®¹ CommonJS å’Œ AMD è§„èŒƒ
- å½“ä½¿ç”¨ `Rollup/Webpack` ä¹‹ç±»çš„æ‰“åŒ…å™¨æ—¶ï¼Œ`UMD` é€šå¸¸ç”¨ä½œå¤‡ç”¨æ¨¡å—

**4.ESM**

`ESM` ä»£è¡¨ `ES` æ¨¡å—ã€‚è¿™æ˜¯ `Javascript` æå‡ºçš„å®ç°ä¸€ä¸ªæ ‡å‡†æ¨¡å—ç³»ç»Ÿçš„æ–¹æ¡ˆ.

```js
import {foo, bar} from './myLib';

...

export default function() {
  // your Function
};
export const function1() {...};
export const function2() {...};
```

- åœ¨å¾ˆå¤š[ç°ä»£æµè§ˆå™¨](https://link.juejin.cn?target=https%3A%2F%2Fcaniuse.com%2Fes6-module)å¯ä»¥ä½¿ç”¨
- å®ƒå…¼å…·ä¸¤æ–¹é¢çš„ä¼˜ç‚¹ï¼šå…·æœ‰ `CJS` çš„ç®€å•è¯­æ³•å’Œ `AMD` çš„å¼‚æ­¥
- å¾—ç›Šäº `ES6` çš„[é™æ€æ¨¡å—ç»“æ„](https://link.juejin.cn?target=https%3A%2F%2Fexploringjs.com%2Fes6%2Fch_modules.html%23sec_design-goals-es6-modules)ï¼Œå¯ä»¥è¿›è¡Œ [ Tree Shaking](https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Ffundamentals%2Fperformance%2Foptimizing-javascript%2Ftree-shaking%2F)
- `ESM` å…è®¸åƒ `Rollup` è¿™æ ·çš„æ‰“åŒ…å™¨ï¼Œ[åˆ é™¤ä¸å¿…è¦çš„ä»£ç ](https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Fbennypowers%2Fyou-should-be-using-esm-kn3)ï¼Œå‡å°‘ä»£ç åŒ…å¯ä»¥è·å¾—æ›´å¿«çš„åŠ è½½
- å¯ä»¥åœ¨ `HTML` ä¸­è°ƒç”¨ï¼Œåªè¦å¦‚ä¸‹

```javascript
<script type="module">
  import {func1} from 'my-lib';

  func1();
</script>
```



# NPM

åˆå§‹åŒ–é¡¹ç›®

```
npm init -y
```